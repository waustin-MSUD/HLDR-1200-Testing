<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>War on Drugs (Illuminated)</title>
<style type="text/css">
html { box-sizing: border-box;}
*, *:before, *:after { box-sizing: inherit;}

html, body {
margin: 0px;
padding: 0px;
font-family:'Open Sans', 'Source Code Pro', 'Deja Vu Sans', 'Arial', sans-serif;
font-size: 12pt;
}

input {
font-family:'Open Sans', 'Source Code Pro', 'Deja Vu Sans', 'Arial', sans-serif;
}

#header {
border: 1px solid #990;
width: 100%;
height: 35px;
font-size: 12pt;
font-weight: bold;
background: #36c;
color: #eef;
padding: 5px;
}

#workspace {
position: absolute;
top: 35px;
left: 0;
right: 0;
bottom: 25px;
}

#sidebar {
position: absolute;
left: 0;
top: 0px;
bottom: 0px;
width: 250px;
border-right: 1px solid #999;
background: #eee;
}
#sidebar span {
display: inline-block;
width: 100%;
text-decoration: none;
color: #009;
cursor: pointer;
}
#sidebar span:hover {
background: #ffc;
text-decoration: underline;
}
#links {
height: 120px;
font-size: 10pt;
padding: 4px;
}
#passageListHeader {
width: 100%;
height: 25px;
padding: 0px;
}
#filter {
font-size: 10pt;
font-weight: bold;
margin: 0px;
padding: 0px;
width: 100%;
height: 25px;
border: 0px;
border-top: 1px solid #999;
border-bottom: 1px solid #999;
background: #ddf;
}
#filter:focus {
outline: none;
box-shadow: none;
}
#passageListContent {
position: absolute;
top: 145px;
bottom: 0;
left: 0;
width: 250px;
overflow: auto;
padding: 4px;
font-size: 10pt;
}
.flag {
display: inline-block;
float: right;
width: 15px;
height: 15px;
font-size: 7pt;
text-align: center;
font-weight: bold;
margin: 2px 2px 0px 0px;
}
.reviewed {
border: 1px solid #090;
background: #bfb;
border-radius: 5px;
}
.changed {
border: 1px solid #900;
background: #fbb;
border-radius: 7px;
}


#contentArea { 
height: 99%;
margin-left: 250px;
padding: 5px 5px 5px 10px;
overflow: auto;
}


#generalOutput {
display: none;
}
#generalHeader {
height: 35px;
padding: 2px;
border-bottom: 1px solid #999;
}
#generalTitle {
display: inline-block;
font-weight: bold;
font-size: 16pt;
}

.infoTile {
display: inline-block;
float: left;
overflow: auto;
border: 1px solid #999;
border-radius: 5px;
margin: 10px 10px 0px 0px;
}
.tile1x1 {
width: 200px;
height: 250px;
}
.tile2x1 {
width: 410px;
height: 250px;
}
.tile1x2 {
width: 200px;
height: 510px;
}
.tile2x2 {
width: 410px;
height: 510px;
}
.infoTile .title {
background: #ddf;
display: block;
font-weight: bold;
border-bottom: 1px solid #999;
padding: 1px 2px 1px 4px;
}

.infoTile .content {
font-size: 8pt;
}
.infoTile p {
margin: 0px;
padding: 4px;
line-height: 150%;
}
.infoTile table {
border-spacing: 0px;
width: 100%;
font-size: 8pt;
}
.infoTile table tr.header td {
background: #eee;
border-bottom: 1px solid #999;
font-weight: bold;
}
.infoTile table td {
padding: 2px;
margin: 0px;
text-align: right;
padding-right: 4px;
border-left: 1px solid #999;
}
.infoTile table td:nth-of-type(1) {
border-left: 0px;
padding-left: 4px;
text-align: left;
}
.infoTile span.link {
display: inline-block;
width: 100%;
text-decoration: none;
color: #009;
cursor: pointer;
}
.infoTile span.link:hover {
background: #ffc;
text-decoration: underline;
}



#passageViewer {
display: none;
}
#passageHeader {
height: 35px;
padding: 2px;
border-bottom: 1px solid #999;
}
#passageTitle {
display: inline-block;
font-weight: bold;
font-size: 16pt;
}
#passageTags {
position: absolute;
top: 0;
display: inline-block;
padding: 0px 0px 0px 15px;
margin-top: 10px;
}

#passageControls {
display: block;
font-size: 9pt;
border-bottom: 1px solid #999;
background: #eee;
height: 25px;
padding: 2px 5px 1px 5px;
}
#passageControls input {
font-size: 8pt;
}
#dirtyControls {
float: right;
display: none;
}
#reviewedControls {
display: none;
}
#unreviewedControls {
display: none;
}

#passageContent {
position: absolute;
top: 60px;
bottom: 0;
left: 260px;
right: 0;
}
/* #editor {
margin-top: 5px;
font-size: 14pt;
position: absolute;
top: 0;
bottom: 0;
left: 0;
width: 100%;
resize: vertical;
margin-bottom: 400px;
border: 0px;
} */
#editor {
font-size: 14pt;
width: 100%;
height: 99%;
resize: none;
}
#editorCorral {
margin-top: 5px;
position: absolute;
top: 0;
bottom: 0;
left: 0;
width: 100%;
border: 0px;
}

#editor:focus {
outline: 0px;
}
#changeViewer {
font-size: 10pt;
white-space: pre-wrap;
display: none;
border-top: 1px dashed #999;
padding-top: 10px;
position: absolute;
bottom: 0;
left: 0;
right: 0;
width: 100%;
height: 300px;
overflow: auto;
}

.tag {
border: 1px solid #cc9;
padding: 1px 5px 1px 5px;
margin-right: 4px;
margin-bottom: 3px;
background: #fea;
color: #660;
border-radius: 3px;
font-size: 9pt;
cursor: pointer;
}

ins {
background: #9f9;
}

del {
background: #f99;
}

#footer {
position: absolute;
height: 25px;
bottom: 0;
left: 0;
right: 0;
font-weight: bold;
background: #36c;
color: #eef;
font-size: 12pt;
padding: 1px 4px 0px 4px;
}
#footer input {
font-weight: bold;
font-size: 8pt;
}
#footerLeft {
}
#footerRight {
float: right;
}
</style>
<script type="text/javascript">
/**
 * Diff Match and Patch
 *
 * Copyright 2006 Google Inc.
 * http://code.google.com/p/google-diff-match-patch/
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(function(){function diff_match_patch(){this.Diff_Timeout=1;this.Diff_EditCost=4;this.Match_Threshold=0.5;this.Match_Distance=1E3;this.Patch_DeleteThreshold=0.5;this.Patch_Margin=4;this.Match_MaxBits=32}
diff_match_patch.prototype.diff_main=function(a,b,c,d){"undefined"==typeof d&&(d=0>=this.Diff_Timeout?Number.MAX_VALUE:(new Date).getTime()+1E3*this.Diff_Timeout);if(null==a||null==b)throw Error("Null input. (diff_main)");if(a==b)return a?[[0,a]]:[];"undefined"==typeof c&&(c=!0);var e=c,f=this.diff_commonPrefix(a,b);c=a.substring(0,f);a=a.substring(f);b=b.substring(f);var f=this.diff_commonSuffix(a,b),g=a.substring(a.length-f);a=a.substring(0,a.length-f);b=b.substring(0,b.length-f);a=this.diff_compute_(a,
b,e,d);c&&a.unshift([0,c]);g&&a.push([0,g]);this.diff_cleanupMerge(a);return a};
diff_match_patch.prototype.diff_compute_=function(a,b,c,d){if(!a)return[[1,b]];if(!b)return[[-1,a]];var e=a.length>b.length?a:b,f=a.length>b.length?b:a,g=e.indexOf(f);return-1!=g?(c=[[1,e.substring(0,g)],[0,f],[1,e.substring(g+f.length)]],a.length>b.length&&(c[0][0]=c[2][0]=-1),c):1==f.length?[[-1,a],[1,b]]:(e=this.diff_halfMatch_(a,b))?(f=e[0],a=e[1],g=e[2],b=e[3],e=e[4],f=this.diff_main(f,g,c,d),c=this.diff_main(a,b,c,d),f.concat([[0,e]],c)):c&&100<a.length&&100<b.length?this.diff_lineMode_(a,b,
d):this.diff_bisect_(a,b,d)};
diff_match_patch.prototype.diff_lineMode_=function(a,b,c){var d=this.diff_linesToChars_(a,b);a=d.chars1;b=d.chars2;d=d.lineArray;a=this.diff_main(a,b,!1,c);this.diff_charsToLines_(a,d);this.diff_cleanupSemantic(a);a.push([0,""]);for(var e=d=b=0,f="",g="";b<a.length;){switch(a[b][0]){case 1:e++;g+=a[b][1];break;case -1:d++;f+=a[b][1];break;case 0:if(1<=d&&1<=e){a.splice(b-d-e,d+e);b=b-d-e;d=this.diff_main(f,g,!1,c);for(e=d.length-1;0<=e;e--)a.splice(b,0,d[e]);b+=d.length}d=e=0;g=f=""}b++}a.pop();return a};
diff_match_patch.prototype.diff_bisect_=function(a,b,c){for(var d=a.length,e=b.length,f=Math.ceil((d+e)/2),g=f,h=2*f,j=Array(h),i=Array(h),k=0;k<h;k++)j[k]=-1,i[k]=-1;j[g+1]=0;i[g+1]=0;for(var k=d-e,q=0!=k%2,r=0,t=0,p=0,w=0,v=0;v<f&&!((new Date).getTime()>c);v++){for(var n=-v+r;n<=v-t;n+=2){var l=g+n,m;m=n==-v||n!=v&&j[l-1]<j[l+1]?j[l+1]:j[l-1]+1;for(var s=m-n;m<d&&s<e&&a.charAt(m)==b.charAt(s);)m++,s++;j[l]=m;if(m>d)t+=2;else if(s>e)r+=2;else if(q&&(l=g+k-n,0<=l&&l<h&&-1!=i[l])){var u=d-i[l];if(m>=
u)return this.diff_bisectSplit_(a,b,m,s,c)}}for(n=-v+p;n<=v-w;n+=2){l=g+n;u=n==-v||n!=v&&i[l-1]<i[l+1]?i[l+1]:i[l-1]+1;for(m=u-n;u<d&&m<e&&a.charAt(d-u-1)==b.charAt(e-m-1);)u++,m++;i[l]=u;if(u>d)w+=2;else if(m>e)p+=2;else if(!q&&(l=g+k-n,0<=l&&(l<h&&-1!=j[l])&&(m=j[l],s=g+m-l,u=d-u,m>=u)))return this.diff_bisectSplit_(a,b,m,s,c)}}return[[-1,a],[1,b]]};
diff_match_patch.prototype.diff_bisectSplit_=function(a,b,c,d,e){var f=a.substring(0,c),g=b.substring(0,d);a=a.substring(c);b=b.substring(d);f=this.diff_main(f,g,!1,e);e=this.diff_main(a,b,!1,e);return f.concat(e)};
diff_match_patch.prototype.diff_linesToChars_=function(a,b){function c(a){for(var b="",c=0,f=-1,g=d.length;f<a.length-1;){f=a.indexOf("\\n",c);-1==f&&(f=a.length-1);var r=a.substring(c,f+1),c=f+1;(e.hasOwnProperty?e.hasOwnProperty(r):void 0!==e[r])?b+=String.fromCharCode(e[r]):(b+=String.fromCharCode(g),e[r]=g,d[g++]=r)}return b}var d=[],e={};d[0]="";var f=c(a),g=c(b);return{chars1:f,chars2:g,lineArray:d}};
diff_match_patch.prototype.diff_charsToLines_=function(a,b){for(var c=0;c<a.length;c++){for(var d=a[c][1],e=[],f=0;f<d.length;f++)e[f]=b[d.charCodeAt(f)];a[c][1]=e.join("")}};diff_match_patch.prototype.diff_commonPrefix=function(a,b){if(!a||!b||a.charAt(0)!=b.charAt(0))return 0;for(var c=0,d=Math.min(a.length,b.length),e=d,f=0;c<e;)a.substring(f,e)==b.substring(f,e)?f=c=e:d=e,e=Math.floor((d-c)/2+c);return e};
diff_match_patch.prototype.diff_commonSuffix=function(a,b){if(!a||!b||a.charAt(a.length-1)!=b.charAt(b.length-1))return 0;for(var c=0,d=Math.min(a.length,b.length),e=d,f=0;c<e;)a.substring(a.length-e,a.length-f)==b.substring(b.length-e,b.length-f)?f=c=e:d=e,e=Math.floor((d-c)/2+c);return e};
diff_match_patch.prototype.diff_commonOverlap_=function(a,b){var c=a.length,d=b.length;if(0==c||0==d)return 0;c>d?a=a.substring(c-d):c<d&&(b=b.substring(0,c));c=Math.min(c,d);if(a==b)return c;for(var d=0,e=1;;){var f=a.substring(c-e),f=b.indexOf(f);if(-1==f)return d;e+=f;if(0==f||a.substring(c-e)==b.substring(0,e))d=e,e++}};
diff_match_patch.prototype.diff_halfMatch_=function(a,b){function c(a,b,c){for(var d=a.substring(c,c+Math.floor(a.length/4)),e=-1,g="",h,j,n,l;-1!=(e=b.indexOf(d,e+1));){var m=f.diff_commonPrefix(a.substring(c),b.substring(e)),s=f.diff_commonSuffix(a.substring(0,c),b.substring(0,e));g.length<s+m&&(g=b.substring(e-s,e)+b.substring(e,e+m),h=a.substring(0,c-s),j=a.substring(c+m),n=b.substring(0,e-s),l=b.substring(e+m))}return 2*g.length>=a.length?[h,j,n,l,g]:null}if(0>=this.Diff_Timeout)return null;
var d=a.length>b.length?a:b,e=a.length>b.length?b:a;if(4>d.length||2*e.length<d.length)return null;var f=this,g=c(d,e,Math.ceil(d.length/4)),d=c(d,e,Math.ceil(d.length/2)),h;if(!g&&!d)return null;h=d?g?g[4].length>d[4].length?g:d:d:g;var j;a.length>b.length?(g=h[0],d=h[1],e=h[2],j=h[3]):(e=h[0],j=h[1],g=h[2],d=h[3]);h=h[4];return[g,d,e,j,h]};
diff_match_patch.prototype.diff_cleanupSemantic=function(a){for(var b=!1,c=[],d=0,e=null,f=0,g=0,h=0,j=0,i=0;f<a.length;)0==a[f][0]?(c[d++]=f,g=j,h=i,i=j=0,e=a[f][1]):(1==a[f][0]?j+=a[f][1].length:i+=a[f][1].length,e&&(e.length<=Math.max(g,h)&&e.length<=Math.max(j,i))&&(a.splice(c[d-1],0,[-1,e]),a[c[d-1]+1][0]=1,d--,d--,f=0<d?c[d-1]:-1,i=j=h=g=0,e=null,b=!0)),f++;b&&this.diff_cleanupMerge(a);this.diff_cleanupSemanticLossless(a);for(f=1;f<a.length;){if(-1==a[f-1][0]&&1==a[f][0]){b=a[f-1][1];c=a[f][1];
d=this.diff_commonOverlap_(b,c);e=this.diff_commonOverlap_(c,b);if(d>=e){if(d>=b.length/2||d>=c.length/2)a.splice(f,0,[0,c.substring(0,d)]),a[f-1][1]=b.substring(0,b.length-d),a[f+1][1]=c.substring(d),f++}else if(e>=b.length/2||e>=c.length/2)a.splice(f,0,[0,b.substring(0,e)]),a[f-1][0]=1,a[f-1][1]=c.substring(0,c.length-e),a[f+1][0]=-1,a[f+1][1]=b.substring(e),f++;f++}f++}};
diff_match_patch.prototype.diff_cleanupSemanticLossless=function(a){function b(a,b){if(!a||!b)return 6;var c=a.charAt(a.length-1),d=b.charAt(0),e=c.match(diff_match_patch.nonAlphaNumericRegex_),f=d.match(diff_match_patch.nonAlphaNumericRegex_),g=e&&c.match(diff_match_patch.whitespaceRegex_),h=f&&d.match(diff_match_patch.whitespaceRegex_),c=g&&c.match(diff_match_patch.linebreakRegex_),d=h&&d.match(diff_match_patch.linebreakRegex_),i=c&&a.match(diff_match_patch.blanklineEndRegex_),j=d&&b.match(diff_match_patch.blanklineStartRegex_);
return i||j?5:c||d?4:e&&!g&&h?3:g||h?2:e||f?1:0}for(var c=1;c<a.length-1;){if(0==a[c-1][0]&&0==a[c+1][0]){var d=a[c-1][1],e=a[c][1],f=a[c+1][1],g=this.diff_commonSuffix(d,e);if(g)var h=e.substring(e.length-g),d=d.substring(0,d.length-g),e=h+e.substring(0,e.length-g),f=h+f;for(var g=d,h=e,j=f,i=b(d,e)+b(e,f);e.charAt(0)===f.charAt(0);){var d=d+e.charAt(0),e=e.substring(1)+f.charAt(0),f=f.substring(1),k=b(d,e)+b(e,f);k>=i&&(i=k,g=d,h=e,j=f)}a[c-1][1]!=g&&(g?a[c-1][1]=g:(a.splice(c-1,1),c--),a[c][1]=
h,j?a[c+1][1]=j:(a.splice(c+1,1),c--))}c++}};diff_match_patch.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/;diff_match_patch.whitespaceRegex_=/\s/;diff_match_patch.linebreakRegex_=/[\\r\\n]/;diff_match_patch.blanklineEndRegex_=/\\n\\r?\\n$/;diff_match_patch.blanklineStartRegex_=/^\\r?\\n\\r?\\n/;
diff_match_patch.prototype.diff_cleanupEfficiency=function(a){for(var b=!1,c=[],d=0,e=null,f=0,g=!1,h=!1,j=!1,i=!1;f<a.length;){if(0==a[f][0])a[f][1].length<this.Diff_EditCost&&(j||i)?(c[d++]=f,g=j,h=i,e=a[f][1]):(d=0,e=null),j=i=!1;else if(-1==a[f][0]?i=!0:j=!0,e&&(g&&h&&j&&i||e.length<this.Diff_EditCost/2&&3==g+h+j+i))a.splice(c[d-1],0,[-1,e]),a[c[d-1]+1][0]=1,d--,e=null,g&&h?(j=i=!0,d=0):(d--,f=0<d?c[d-1]:-1,j=i=!1),b=!0;f++}b&&this.diff_cleanupMerge(a)};
diff_match_patch.prototype.diff_cleanupMerge=function(a){a.push([0,""]);for(var b=0,c=0,d=0,e="",f="",g;b<a.length;)switch(a[b][0]){case 1:d++;f+=a[b][1];b++;break;case -1:c++;e+=a[b][1];b++;break;case 0:1<c+d?(0!==c&&0!==d&&(g=this.diff_commonPrefix(f,e),0!==g&&(0<b-c-d&&0==a[b-c-d-1][0]?a[b-c-d-1][1]+=f.substring(0,g):(a.splice(0,0,[0,f.substring(0,g)]),b++),f=f.substring(g),e=e.substring(g)),g=this.diff_commonSuffix(f,e),0!==g&&(a[b][1]=f.substring(f.length-g)+a[b][1],f=f.substring(0,f.length-
g),e=e.substring(0,e.length-g))),0===c?a.splice(b-d,c+d,[1,f]):0===d?a.splice(b-c,c+d,[-1,e]):a.splice(b-c-d,c+d,[-1,e],[1,f]),b=b-c-d+(c?1:0)+(d?1:0)+1):0!==b&&0==a[b-1][0]?(a[b-1][1]+=a[b][1],a.splice(b,1)):b++,c=d=0,f=e=""}""===a[a.length-1][1]&&a.pop();c=!1;for(b=1;b<a.length-1;)0==a[b-1][0]&&0==a[b+1][0]&&(a[b][1].substring(a[b][1].length-a[b-1][1].length)==a[b-1][1]?(a[b][1]=a[b-1][1]+a[b][1].substring(0,a[b][1].length-a[b-1][1].length),a[b+1][1]=a[b-1][1]+a[b+1][1],a.splice(b-1,1),c=!0):a[b][1].substring(0,
a[b+1][1].length)==a[b+1][1]&&(a[b-1][1]+=a[b+1][1],a[b][1]=a[b][1].substring(a[b+1][1].length)+a[b+1][1],a.splice(b+1,1),c=!0)),b++;c&&this.diff_cleanupMerge(a)};diff_match_patch.prototype.diff_xIndex=function(a,b){var c=0,d=0,e=0,f=0,g;for(g=0;g<a.length;g++){1!==a[g][0]&&(c+=a[g][1].length);-1!==a[g][0]&&(d+=a[g][1].length);if(c>b)break;e=c;f=d}return a.length!=g&&-1===a[g][0]?f:f+(b-e)};
diff_match_patch.prototype.diff_prettyHtml=function(a){for(var b=[],c=/&/g,d=/</g,e=/>/g,f=/\\n/g,g=0;g<a.length;g++){var h=a[g][0],j=a[g][1],j=j.replace(c,"&amp;").replace(d,"&lt;").replace(e,"&gt;").replace(f,"&para;<br>");switch(h){case 1:b[g]='<ins style="background:#e6ffe6;">'+j+"</ins>";break;case -1:b[g]='<del style="background:#ffe6e6;">'+j+"</del>";break;case 0:b[g]="<span>"+j+"</span>"}}return b.join("")};
diff_match_patch.prototype.diff_text1=function(a){for(var b=[],c=0;c<a.length;c++)1!==a[c][0]&&(b[c]=a[c][1]);return b.join("")};diff_match_patch.prototype.diff_text2=function(a){for(var b=[],c=0;c<a.length;c++)-1!==a[c][0]&&(b[c]=a[c][1]);return b.join("")};diff_match_patch.prototype.diff_levenshtein=function(a){for(var b=0,c=0,d=0,e=0;e<a.length;e++){var f=a[e][0],g=a[e][1];switch(f){case 1:c+=g.length;break;case -1:d+=g.length;break;case 0:b+=Math.max(c,d),d=c=0}}return b+=Math.max(c,d)};
diff_match_patch.prototype.diff_toDelta=function(a){for(var b=[],c=0;c<a.length;c++)switch(a[c][0]){case 1:b[c]="+"+encodeURI(a[c][1]);break;case -1:b[c]="-"+a[c][1].length;break;case 0:b[c]="="+a[c][1].length}return b.join("\t").replace(/%20/g," ")};
diff_match_patch.prototype.diff_fromDelta=function(a,b){for(var c=[],d=0,e=0,f=b.split(/\t/g),g=0;g<f.length;g++){var h=f[g].substring(1);switch(f[g].charAt(0)){case "+":try{c[d++]=[1,decodeURI(h)]}catch(j){throw Error("Illegal escape in diff_fromDelta: "+h);}break;case "-":case "=":var i=parseInt(h,10);if(isNaN(i)||0>i)throw Error("Invalid number in diff_fromDelta: "+h);h=a.substring(e,e+=i);"="==f[g].charAt(0)?c[d++]=[0,h]:c[d++]=[-1,h];break;default:if(f[g])throw Error("Invalid diff operation in diff_fromDelta: "+
f[g]);}}if(e!=a.length)throw Error("Delta length ("+e+") does not equal source text length ("+a.length+").");return c};diff_match_patch.prototype.match_main=function(a,b,c){if(null==a||null==b||null==c)throw Error("Null input. (match_main)");c=Math.max(0,Math.min(c,a.length));return a==b?0:a.length?a.substring(c,c+b.length)==b?c:this.match_bitap_(a,b,c):-1};
diff_match_patch.prototype.match_bitap_=function(a,b,c){function d(a,d){var e=a/b.length,g=Math.abs(c-d);return!f.Match_Distance?g?1:e:e+g/f.Match_Distance}if(b.length>this.Match_MaxBits)throw Error("Pattern too long for this browser.");var e=this.match_alphabet_(b),f=this,g=this.Match_Threshold,h=a.indexOf(b,c);-1!=h&&(g=Math.min(d(0,h),g),h=a.lastIndexOf(b,c+b.length),-1!=h&&(g=Math.min(d(0,h),g)));for(var j=1<<b.length-1,h=-1,i,k,q=b.length+a.length,r,t=0;t<b.length;t++){i=0;for(k=q;i<k;)d(t,c+
k)<=g?i=k:q=k,k=Math.floor((q-i)/2+i);q=k;i=Math.max(1,c-k+1);var p=Math.min(c+k,a.length)+b.length;k=Array(p+2);for(k[p+1]=(1<<t)-1;p>=i;p--){var w=e[a.charAt(p-1)];k[p]=0===t?(k[p+1]<<1|1)&w:(k[p+1]<<1|1)&w|((r[p+1]|r[p])<<1|1)|r[p+1];if(k[p]&j&&(w=d(t,p-1),w<=g))if(g=w,h=p-1,h>c)i=Math.max(1,2*c-h);else break}if(d(t+1,c)>g)break;r=k}return h};
diff_match_patch.prototype.match_alphabet_=function(a){for(var b={},c=0;c<a.length;c++)b[a.charAt(c)]=0;for(c=0;c<a.length;c++)b[a.charAt(c)]|=1<<a.length-c-1;return b};
diff_match_patch.prototype.patch_addContext_=function(a,b){if(0!=b.length){for(var c=b.substring(a.start2,a.start2+a.length1),d=0;b.indexOf(c)!=b.lastIndexOf(c)&&c.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)d+=this.Patch_Margin,c=b.substring(a.start2-d,a.start2+a.length1+d);d+=this.Patch_Margin;(c=b.substring(a.start2-d,a.start2))&&a.diffs.unshift([0,c]);(d=b.substring(a.start2+a.length1,a.start2+a.length1+d))&&a.diffs.push([0,d]);a.start1-=c.length;a.start2-=c.length;a.length1+=
c.length+d.length;a.length2+=c.length+d.length}};
diff_match_patch.prototype.patch_make=function(a,b,c){var d;if("string"==typeof a&&"string"==typeof b&&"undefined"==typeof c)d=a,b=this.diff_main(d,b,!0),2<b.length&&(this.diff_cleanupSemantic(b),this.diff_cleanupEfficiency(b));else if(a&&"object"==typeof a&&"undefined"==typeof b&&"undefined"==typeof c)b=a,d=this.diff_text1(b);else if("string"==typeof a&&b&&"object"==typeof b&&"undefined"==typeof c)d=a;else if("string"==typeof a&&"string"==typeof b&&c&&"object"==typeof c)d=a,b=c;else throw Error("Unknown call format to patch_make.");
if(0===b.length)return[];c=[];a=new diff_match_patch.patch_obj;for(var e=0,f=0,g=0,h=d,j=0;j<b.length;j++){var i=b[j][0],k=b[j][1];!e&&0!==i&&(a.start1=f,a.start2=g);switch(i){case 1:a.diffs[e++]=b[j];a.length2+=k.length;d=d.substring(0,g)+k+d.substring(g);break;case -1:a.length1+=k.length;a.diffs[e++]=b[j];d=d.substring(0,g)+d.substring(g+k.length);break;case 0:k.length<=2*this.Patch_Margin&&e&&b.length!=j+1?(a.diffs[e++]=b[j],a.length1+=k.length,a.length2+=k.length):k.length>=2*this.Patch_Margin&&
e&&(this.patch_addContext_(a,h),c.push(a),a=new diff_match_patch.patch_obj,e=0,h=d,f=g)}1!==i&&(f+=k.length);-1!==i&&(g+=k.length)}e&&(this.patch_addContext_(a,h),c.push(a));return c};diff_match_patch.prototype.patch_deepCopy=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c],e=new diff_match_patch.patch_obj;e.diffs=[];for(var f=0;f<d.diffs.length;f++)e.diffs[f]=d.diffs[f].slice();e.start1=d.start1;e.start2=d.start2;e.length1=d.length1;e.length2=d.length2;b[c]=e}return b};
diff_match_patch.prototype.patch_apply=function(a,b){if(0==a.length)return[b,[]];a=this.patch_deepCopy(a);var c=this.patch_addPadding(a);b=c+b+c;this.patch_splitMax(a);for(var d=0,e=[],f=0;f<a.length;f++){var g=a[f].start2+d,h=this.diff_text1(a[f].diffs),j,i=-1;if(h.length>this.Match_MaxBits){if(j=this.match_main(b,h.substring(0,this.Match_MaxBits),g),-1!=j&&(i=this.match_main(b,h.substring(h.length-this.Match_MaxBits),g+h.length-this.Match_MaxBits),-1==i||j>=i))j=-1}else j=this.match_main(b,h,g);
if(-1==j)e[f]=!1,d-=a[f].length2-a[f].length1;else if(e[f]=!0,d=j-g,g=-1==i?b.substring(j,j+h.length):b.substring(j,i+this.Match_MaxBits),h==g)b=b.substring(0,j)+this.diff_text2(a[f].diffs)+b.substring(j+h.length);else if(g=this.diff_main(h,g,!1),h.length>this.Match_MaxBits&&this.diff_levenshtein(g)/h.length>this.Patch_DeleteThreshold)e[f]=!1;else{this.diff_cleanupSemanticLossless(g);for(var h=0,k,i=0;i<a[f].diffs.length;i++){var q=a[f].diffs[i];0!==q[0]&&(k=this.diff_xIndex(g,h));1===q[0]?b=b.substring(0,
j+k)+q[1]+b.substring(j+k):-1===q[0]&&(b=b.substring(0,j+k)+b.substring(j+this.diff_xIndex(g,h+q[1].length)));-1!==q[0]&&(h+=q[1].length)}}}b=b.substring(c.length,b.length-c.length);return[b,e]};
diff_match_patch.prototype.patch_addPadding=function(a){for(var b=this.Patch_Margin,c="",d=1;d<=b;d++)c+=String.fromCharCode(d);for(d=0;d<a.length;d++)a[d].start1+=b,a[d].start2+=b;var d=a[0],e=d.diffs;if(0==e.length||0!=e[0][0])e.unshift([0,c]),d.start1-=b,d.start2-=b,d.length1+=b,d.length2+=b;else if(b>e[0][1].length){var f=b-e[0][1].length;e[0][1]=c.substring(e[0][1].length)+e[0][1];d.start1-=f;d.start2-=f;d.length1+=f;d.length2+=f}d=a[a.length-1];e=d.diffs;0==e.length||0!=e[e.length-1][0]?(e.push([0,
c]),d.length1+=b,d.length2+=b):b>e[e.length-1][1].length&&(f=b-e[e.length-1][1].length,e[e.length-1][1]+=c.substring(0,f),d.length1+=f,d.length2+=f);return c};
diff_match_patch.prototype.patch_splitMax=function(a){for(var b=this.Match_MaxBits,c=0;c<a.length;c++)if(!(a[c].length1<=b)){var d=a[c];a.splice(c--,1);for(var e=d.start1,f=d.start2,g="";0!==d.diffs.length;){var h=new diff_match_patch.patch_obj,j=!0;h.start1=e-g.length;h.start2=f-g.length;""!==g&&(h.length1=h.length2=g.length,h.diffs.push([0,g]));for(;0!==d.diffs.length&&h.length1<b-this.Patch_Margin;){var g=d.diffs[0][0],i=d.diffs[0][1];1===g?(h.length2+=i.length,f+=i.length,h.diffs.push(d.diffs.shift()),
j=!1):-1===g&&1==h.diffs.length&&0==h.diffs[0][0]&&i.length>2*b?(h.length1+=i.length,e+=i.length,j=!1,h.diffs.push([g,i]),d.diffs.shift()):(i=i.substring(0,b-h.length1-this.Patch_Margin),h.length1+=i.length,e+=i.length,0===g?(h.length2+=i.length,f+=i.length):j=!1,h.diffs.push([g,i]),i==d.diffs[0][1]?d.diffs.shift():d.diffs[0][1]=d.diffs[0][1].substring(i.length))}g=this.diff_text2(h.diffs);g=g.substring(g.length-this.Patch_Margin);i=this.diff_text1(d.diffs).substring(0,this.Patch_Margin);""!==i&&
(h.length1+=i.length,h.length2+=i.length,0!==h.diffs.length&&0===h.diffs[h.diffs.length-1][0]?h.diffs[h.diffs.length-1][1]+=i:h.diffs.push([0,i]));j||a.splice(++c,0,h)}}};diff_match_patch.prototype.patch_toText=function(a){for(var b=[],c=0;c<a.length;c++)b[c]=a[c];return b.join("")};
diff_match_patch.prototype.patch_fromText=function(a){var b=[];if(!a)return b;a=a.split("\\n");for(var c=0,d=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;c<a.length;){var e=a[c].match(d);if(!e)throw Error("Invalid patch string: "+a[c]);var f=new diff_match_patch.patch_obj;b.push(f);f.start1=parseInt(e[1],10);""===e[2]?(f.start1--,f.length1=1):"0"==e[2]?f.length1=0:(f.start1--,f.length1=parseInt(e[2],10));f.start2=parseInt(e[3],10);""===e[4]?(f.start2--,f.length2=1):"0"==e[4]?f.length2=0:(f.start2--,f.length2=
parseInt(e[4],10));for(c++;c<a.length;){e=a[c].charAt(0);try{var g=decodeURI(a[c].substring(1))}catch(h){throw Error("Illegal escape in patch_fromText: "+g);}if("-"==e)f.diffs.push([-1,g]);else if("+"==e)f.diffs.push([1,g]);else if(" "==e)f.diffs.push([0,g]);else if("@"==e)break;else if(""!==e)throw Error('Invalid patch mode "'+e+'" in: '+g);c++}}return b};diff_match_patch.patch_obj=function(){this.diffs=[];this.start2=this.start1=null;this.length2=this.length1=0};
diff_match_patch.patch_obj.prototype.toString=function(){var a,b;a=0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1;b=0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2;a=["@@ -"+a+" +"+b+" @@\\n"];var c;for(b=0;b<this.diffs.length;b++){switch(this.diffs[b][0]){case 1:c="+";break;case -1:c="-";break;case 0:c=" "}a[b+1]=c+encodeURI(this.diffs[b][1])+"\\n"}return a.join("").replace(/%20/g," ")};
this.diff_match_patch=diff_match_patch;this.DIFF_DELETE=-1;this.DIFF_INSERT=1;this.DIFF_EQUAL=0;})()</script>
<script type="text/javascript">
/**
 * Illume - Twine Proofing Story Format
 * 
 * Copyright (c) 2015 Michael McCollum
 * http://www.maximumverbosity.net/twine/Illume/
 *
 * This license applies exclusively to the Illume story format for Twine 2. No ownership of, nor
 * licensing restrictions on, the content within the generated story are stated or implied.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and
 * associated documentation files (the "Software"), to deal in the Software without restriction,
 * including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense,
 * and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so,
 * subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all copies or substantial
 * portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT
 * LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
 * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
 * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
window.onload = function() {
if (typeof(window.Illume) == "undefined") {


window.Illume = {

init: function() { 
Illume.UI.init();
Illume.Editor.init();
Illume.Diff.init();
Illume.Story.init();
Illume.Passages.init();
Illume.Overview.init();

this.UI.updateList();
this.Overview.showStoryOverview();

},


popout:function(content) {
var w = window.open();
w.document.write(content);
},

download:function(filename, text, contentType) {
if (!contentType)
contentType = 'text/plain';

window.URL = window.URL || window.webkitURL;
var dataBlob = new Blob([text], {type: contentType});

var downloader = document.createElement('a');
downloader.setAttribute('innerHtml', 'downloader');
downloader.setAttribute('href', window.URL.createObjectURL(dataBlob));
downloader.setAttribute('download', filename);
downloader.onclick = function() {
document.body.removeChild(event.target);
};
document.body.appendChild(downloader);
downloader.click();
},

viewChangeList:function() {
this.generateChangeList(false);
},

saveChangeList:function() {
this.generateChangeList(true);
},

generateChangeList:function(forExport) {
var buffer = [];
var diffs;
var p;

var matches = Illume.Passages.findPassages(function(p) { return p.changed;});
var title = Illume.Story.storyName + ' Change List - ' + (new Date()).toLocaleString();

if (matches.length < 1) {
alert('No changes have been made.');
return '';
}

buffer.push('<html><he','ad>');
buffer.push('<title>',title,'</title>');
buffer.push('<style type="text/css">');
buffer.push('ins {background: #9f9;} del {background: #f99;}');
buffer.push("body{font-family:'Open Sans','Source Code Pro','Deja Vu Sans','Arial',sans-serif;}");
buffer.push("h1{text-align:center;}");
buffer.push("h2{margin:50px 0px 0px 10px;}");
buffer.push("input{float:right;}");
buffer.push("pre{margin: 0px;line-height: 175%;font-size: 12pt;border: solid #999;border-width: 1px 0px 1px 0px;}");
buffer.push('</style>');
buffer.push('</he','ad><bo','dy>');

buffer.push('<h1>', title, '</h1>');

for (var i in matches) {
p = matches[i];
diffs = window.Illume.Diff.diff(this.encodeEntities(p.originalContent), this.encodeEntities(p.content));

buffer.push('<div id="p.' + p.id + '">');
buffer.push('<input type="button" value="Done" onclick="this.parentNode.remove(this);" />');
buffer.push("<h2>", p.name, "</h2>");
buffer.push("<pre>", window.Illume.Diff.formatDiffs(diffs),"</pre>");
buffer.push("</div>");
}

buffer.push('</bo', 'dy></html>');

var output = buffer.join('');

if (forExport) {
this.download(title + '.html', output, 'text/html');
} else {
this.popout(output);
}

},

encodeEntities:function(s) {
return String(s).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
},

exportTwee: function() {
this.download(Illume.Story.storyName + ".tw", Illume.Entweedle.export(), 'text/plain');
},

saveToFile:function() {
alert("Note: the saved file will be a fresh copy of this illumination and will not include any changes you've made to this version.");
this.download(Illume.Story.storyName + " (Illuminated).html", window.document.documentElement.innerHTML, 'text/html');
}


}


window.Illume.Overview = {
introText: '',
tips: '',

init:function() {
this.introText = window.document.getElementById('introText').innerHTML;
this.tips = window.document.getElementById('tips').innerHTML;
},

showStoryOverview:function() {
Illume.Story.compileStats();

var buffer = [];

buffer.push(this.generateTile("Welcome to Illume", Illume.Overview.introText,'2x1'));
buffer.push(this.generateTile("Stats", this.generateTable(Illume.Story.generateStorySummary()) + '<p>These do not reflect changes made during review or by macros during play.</p>'));
buffer.push(this.generateTile("Review Summary", this.generateTable(Illume.Passages.generateReviewSummary())));

buffer.push(this.generateTile("Passage Summary", this.generateTable(Illume.Passages.generateSummary()),'2x1'));
buffer.push(this.generateTile("Tags", this.generateTable(Illume.Story.getTagSummary(), true),'1x1'));

buffer.push(this.generateTile("Tips", Illume.Overview.tips));


Illume.UI.showGeneralOutput('Story Overview', buffer.join(''));
},

generateTile:function(title,content,size,classes) {
var buffer = [];
if (!size)
size = '1x1';

buffer.push('<div class="infoTile tile', size, ' ', classes, '"><div class="title">');
buffer.push(title);
buffer.push('</div><div class="content">');
buffer.push(content);
buffer.push('</div></div>');

return buffer.join('');
},

generateTable:function(o, preserveLabels) {
var label,link,data;
var buffer = [];
var isHeader = false;

buffer.push("<table>");
for (key in o) {
label = key;

if (label.indexOf("header.") > -1) {
label = label.substring(7);
isHeader = true;
} else {
isHeader = false
}


if (!preserveLabels) {
label = label.replace(/[A-Z][a-z]*/g, function(word) { return ' ' + word.charAt(0).toUpperCase() + word.substr(1);});
label = label.charAt(0).toUpperCase() + label.substr(1);
}

data = o[key];

link = data['illumeLink'];

buffer.push("<tr");
if (isHeader) {
buffer.push(' class="header"');
}
buffer.push("><td>");
if (link && link.length > 0) {
buffer.push('<span class="link" onclick="' + link + '">');
}
buffer.push(label);
if (link) {
buffer.push('</span>');
}
buffer.push("</td>");
if (typeof data == "object") {
for (var i in data) {
if (i == 'illumeLink')
continue;

buffer.push('<td>', data[i], '</td>');
}
} else {
buffer.push('<td>', data, '</td>')
}
buffer.push("</tr>");
}
buffer.push("</table>");

return buffer.join('');

}
}


window.Illume.Diff = {
logic: null,

init:function() {
this.logic = new window.diff_match_patch();
},

diff: function(s1, s2) {
var diffs = this.logic.diff_main(s1, s2);
this.cleanup(diffs);
return diffs;
},

cleanup:function(diffs) {
this.logic.diff_cleanupSemantic(diffs);
},

formatDiffs:function(diffs) {
var html = [];
var i = 0;
for (var x = 0; x < diffs.length; x++) {
var op = diffs[x][0];    
var data = diffs[x][1];
var text = data;
switch (op) {
case window.DIFF_INSERT:
html[x] = '<ins>' + text + '</ins>';
break;
case window.DIFF_DELETE:
html[x] = '<del>' + text + '</del>';
break;
case window.DIFF_EQUAL:
html[x] = '' + text + '';
break;
}
if (op !== window.DIFF_DELETE) {
i += data.length;
}
}
return html.join('');
}

}


window.Illume.UI = {
filter:null,
filterTag: null,
byTagOption: null,
passageListContent: null,
passageViewer: null,
generalOutput: null,

init:function() {
this.filter = window.document.getElementById('filter');
this.byTagOption = window.document.getElementById('byTagOption');
this.passageListContent = window.document.getElementById('passageListContent');
this.passageViewer = window.document.getElementById('passageViewer');
this.generalOutput = window.document.getElementById('generalOutput');
},

filterChanged: function() {
if (this.filter.value == 'byTag') {
this.filterTag = null;
}
this.updateList();
},

filterByTag:function(tag) {
this.filterTag = tag;
this.filter.value = 'byTag';
this.updateList();
},

updateFilterList:function() {
this.byTagOption.textContent = "By Tag...";
},

switchFilter:function(value) {
this.filter.value = value;
this.updateList();
},


updateList:function() {
var matches = {};

if (this.filter.value == 'unreviewed') {
matches = Illume.Passages.findPassages(function(p) { return !p.reviewed;});
} else if (this.filter.value == 'reviewed') {
matches = Illume.Passages.findPassages(function(p) { return p.reviewed;});
} else if (this.filter.value == 'changed') {
matches = Illume.Passages.findPassages(function(p) { return p.changed;});
} else if (this.filter.value == 'unchanged') {
matches = Illume.Passages.findPassages(function(p) { return !p.changed;});
} else if (this.filter.value == 'orphans') {
matches = Illume.Passages.findPassages(function(p) { return (p.inboundLinks == 0)});
} else if (this.filter.value == 'deadEnds') {
matches = Illume.Passages.findPassages(function(p) { return (p.links == 0)});
} else if (this.filter.value == 'passThroughs') {
matches = Illume.Passages.findPassages(function(p) { return (p.links == 1 && p.inboundLinks == 1)});
} else if (this.filter.value == 'all') {
matches = Illume.Passages.getAll();
} else if (this.filter.value == 'byTag') {
if (!this.filterTag)
this.filterTag = window.prompt("Show passages with tag:");
if (!this.filterTag)
return;

this.byTagOption.textContent = "By Tag... [" + this.filterTag + "]";

matches = Illume.Passages.findByTag(this.filterTag);
}

this.passageListContent.innerHTML = '';

var buffer = [];

for (var i in matches) {
buffer.push("<span onclick=\"window.Illume.UI.showPassage('", matches[i].id, "');\">");
if (matches[i].reviewed) {
buffer.push('<div class="flag reviewed">R</div>');
}
if (matches[i].changed) {
buffer.push('<div class="flag changed">C</div>');
}
buffer.push(matches[i].name);
buffer.push("</span>");
}

this.passageListContent.innerHTML = buffer.join('');

this.updateFooter();
},

updateFooter:function() {
var footerLeft = window.document.getElementById('footerLeft');
var footerRight = window.document.getElementById('footerRight');

var reviewed = Illume.Passages.countPassages(function(p) { return p.reviewed;});
var changed = Illume.Passages.countPassages(function(p) { return p.changed;});
var total = Illume.Passages.passageCount;
var remaining = total - reviewed;
var reviewedPercentage = Math.ceil((reviewed / total) * 100);

var buffer = [];

if (remaining > 0) {
buffer.push(reviewed, ' reviewed, ');
buffer.push(remaining, ' remaining');
buffer.push(" (");
}
buffer.push(reviewedPercentage, '% reviewed');
if (remaining > 0) {
buffer.push(')');
}

footerLeft.innerHTML = buffer.join('');

buffer = [];

if (changed > 0) {
buffer.push(changed);
buffer.push(' changed <input type="button" id="footerChangeListButton" value="Show Change List" onclick="Illume.viewChangeList()">');
}

footerRight.innerHTML = buffer.join('');



},

showGeneralOutput:function(title, content) {
var header = window.document.getElementById('generalTitle');
var body = window.document.getElementById('generalContent');

header.innerHTML = title;
body.innerHTML = content;

generalOutput.style.display = 'block';
passageViewer.style.display = 'none';
},

showPassage:function(id) {
var p = Illume.Passages.getPassage(id);

if (!p) {
alert(id + ' not found');
return;
}

window.document.getElementById("passageTitle").textContent = p.name;

var tagContainer = window.document.getElementById("passageTags");

tagContainer.innerHTML = '';

var buffer = [];
for (var i in p.tags) {
if (p.tags[i]) {
buffer.push("<span class=\"tag\" onclick=\"window.Illume.UI.filterByTag('");
buffer.push(p.tags[i]);
buffer.push("');\">");
buffer.push(p.tags[i]);
buffer.push("</span>");
}
}

tagContainer.innerHTML = buffer.join('');

Illume.Editor.editPassage(id);

generalOutput.style.display = 'none';
passageViewer.style.display = 'block';

}


}


window.Illume.Editor = {
editor:null,
currentPassageID: null,
currentPassage: null,
changeViewer: null,
controls: null,
changesShown: false,

init:function() {
this.editor = window.document.getElementById('editor');
this.controls = window.document.getElementById('passageControls');
this.changeViewer = window.document.getElementById('changeViewer');

this.editor.onchange = this.changeHandler;
this.editor.onkeyup = this.inputHandler;
},

editPassage:function(id) {
this.currentPassageID = id;
this.currentPassage = Illume.Passages.getPassage(id);

this.editor.value = this.currentPassage.content;
this.updateControls();
},

setReviewedHandler:function(isReviewed) {
Illume.Editor.setReviewed(isReviewed);
},

setReviewed:function(isReviewed) {
if (this.currentPassage.reviewed != isReviewed) {
this.currentPassage.reviewed = isReviewed;
this.updateControls();
Illume.UI.updateList();
}
},

revert:function() {
this.currentPassage.content = this.currentPassage.originalContent;
this.currentPassage.changed = false;
this.editPassage(this.currentPassageID);
Illume.UI.updateList();
this.hideChanges();
},

updateControls:function() {
var c = window.document.getElementById('dirtyControls');
var r = window.document.getElementById('reviewedControls');
var ur = window.document.getElementById('unreviewedControls');

c.style.display = (this.currentPassage.changed) ? 'inline-block' : 'none';
r.style.display = (this.currentPassage.reviewed) ? 'inline-block' : 'none';
ur.style.display = (!this.currentPassage.reviewed) ? 'inline-block' : 'none';

this.currentPassage.changed ? this.showChanges() : this.hideChanges();
},

showChanges: function() {
this.updateChangeViewer(true);
this.updateChangeDiffs();
},

hideChanges:function() {
this.updateChangeViewer(false);
},

toggleChanges:function() {
this.updateChangeViewer(!this.changesShown);
},

updateChangeViewer:function(shown) {
this.changeViewer.style.display = (shown ? 'block' : 'none');
//this.editor.style.bottom = (shown ? '300px' : '0px');   //DEBUG
window.document.getElementById('editorCorral').style.bottom = (shown ? '300px' : '0px');

this.changesShown = shown;
this.updateChangeDiffs();
},

updateChangeDiffs:function() {
if (this.changesShown) {
var p = this.currentPassage;
var diffs = window.Illume.Diff.diff(Illume.encodeEntities(p.originalContent), Illume.encodeEntities(p.content));
this.changeViewer.innerHTML = window.Illume.Diff.formatDiffs(diffs);
}
},

updatePassage:function() {
this.currentPassage.content = this.editor.value;
},

inputHandler:function() {
if (!Illume.Editor.currentPassage.changed) {
Illume.Editor.currentPassage.changed = true;
Illume.UI.updateList();
}
Illume.Editor.updatePassage();
Illume.Editor.updateControls();
Illume.Editor.updateChangeDiffs();
},

changeHandler:function() {
Illume.Editor.updatePassage();
Illume.Editor.updateControls();
Illume.Editor.updateChangeDiffs();
}


}


window.Illume.Story = {
storyData:null,
storyName:'War on Drugs',
storyFormat: '',
startPassage: 1,
stats: {},
wordCount: 0,
tags: {},

init:function() {
this.loadStoryData();
},

loadStoryData:function() {
var storyDataElements = window.document.getElementsByTagName("tw-storydata");
if (storyDataElements.length > 0) {
this.storyData = storyDataElements[0];
this.storyFormat = this.storyData.getAttribute("format");
this.startPassage = this.storyData.getAttribute("startnode");
}
},

compileStats:function() {
var p;

var s = {
format: this.storyFormat,
passageCount: Illume.Passages.passageCount,
wordCount: this.wordCount,
orphans: Illume.Passages.countPassages( function(p) { return (p.inboundLinks < 1); }),
deadEnds: Illume.Passages.countPassages( function(p) { return (p.links < 1); }),
'pass-throughs': Illume.Passages.countPassages( function(p) { return (p.links == 1 && p.inboundLinks == 1); }),

averageLinks: Math.floor(Illume.Passages.averageConnectivity * 100) / 100 ,
averageWords: Math.floor(Illume.Passages.averageLength * 100) / 100

};

this.stats = s;
},

generateStorySummary:function() {
var result = Object.create(this.stats);

result['format'] = result.format;
result.orphans = {
illumeLink:"Illume.UI.switchFilter('orphans');",
value:result.deadEnds
}
result.deadEnds = {
illumeLink:"Illume.UI.switchFilter('deadEnds');",
value:result.deadEnds
}
result['pass-throughs'] = {
illumeLink:"Illume.UI.switchFilter('passThroughs');",
value:result['pass-throughs']
}
result.passageCount = {
illumeLink:"Illume.UI.switchFilter('all');",
value:result.passageCount
}

return result;
},

getTagSummary:function() {
var results = {
"header.Tag": "Occurences"
}
var label;

for (var t in this.tags) {
label = "<span class=\"tag\" onclick=\"window.Illume.UI.filterByTag('" + t + "');\">" + t + "</span>";
results[label] = this.tags[t];
}

return results;
}

}


window.Illume.Passages = {
passages: [],
linkCount:{},
deadLinks:[],
passageCount: 0,
averageConnectivity: 0,
averageLength: 0,

basePassage: {
id:-1,
name: "Undefined",
tags: [],
links: 0,
inboundLinks: 0,
connections: 0,
sugarcubeMacros: 0,
harloweMacros: 0,
harloweHooks: 0,
wordCount: 0,
content: '',
originalContent: '',
reviewed: false,
changed: false
},


init: function() {
this.loadPassages();
},

getPassage: function(id) {
return this.passages[id];
},

getAll:function() {
return this.passages.slice();
},

findByTag:function(tag) {
var results = [];
var p;

results.length = 0;
for (var i = 0; i < this.passages.length; i++) {
p = this.passages[i];
if (p && p.tags.indexOf(tag) > -1) {
results.push(p);
}
}
return results;
},

findByName:function(name) {
var p;

for (var i in this.passages) {
p = this.passages[i];
if (p && p.name == name) {
return p;
}
}
return null;
},

findPassages:function(checkFunction) {
var p;
var results = [];

if (!checkFunction || typeof(checkFunction) != "function") {
return -1;
}

for (var i in this.passages) {
p = this.passages[i];

if (checkFunction(p)) {
results.push(p);
}
}

return results;
},

countPassages:function(checkFunction) {
var results = this.findPassages(checkFunction);
if (!results)
return 0;
else
return results.length;
},

loadPassages: function() {
var passageElements = window.document.getElementsByTagName("tw-passagedata");
var e;
var p;
var tagString;

linkCount = {};

var matchers = {
links:/[^`]\[{2}(.*)\]{2}(?=[^`])/g,
sugarcubeMacros:/\<{2}.*\>{2}/g,
harloweMacros:/[^`]\([^\W]*:.*\)(?=[^`])/g,
harloweHooks:/[^`\[]\[[^\[\]]*\](?=[^`\]])/g
};

this.passages.length = 0;
for (var i = 0; i < passageElements.length; i++) {
p = Object.create(this.basePassage);
e = passageElements[i];

tagString = e.getAttribute("tags").trim();

if (!tagString || tagString.length < 1)
p.tags = [];
else 
p.tags = tagString.split(" ");

if (p.tags.indexOf("illumeIgnore") > -1) {
continue;
}

if (p.tags.indexOf("illumeReviewed") > -1) {
p.reviewed = true;
}

p.id = e.getAttribute("pid");
p.name = e.getAttribute("name");
p.content = e.textContent;
p.originalContent = e.textContent;
p.strippedContent = e.textContent;

for (var j in matchers) {
p[j] = (p.content.match(matchers[j]) || []).length;
}

if (p.harloweMacros > 0)
p.strippedContent = p.strippedContent.replace(matchers.harloweMacros, '');


if (p.sugarcubeMacros > 0)
p.strippedContent = p.strippedContent.replace(matchers.sugarcubeMacros, '');

var re, match, destination;

re = matchers.links;
re.lastIndex = 0;

var destinations = [];


while ((match = re.exec(' ' + p.content + ' ')) !== null) {
destination = match[1];

if (destination.indexOf("->") > -1) {
//harlowe right link
destination = destination.substring(destination.indexOf("->") + 2);
} else if (destination.indexOf("<-") > -1) {
//harlowe left link
destination = destination.substring(0, destination.indexOf("<-"));
} else if (destination.indexOf("|") > -1) {
//sugarcube link
destination = destination.substring(destination.indexOf("|") + 1);
}

if (destinations.indexOf(destination) < 0)
destinations.push(destination);
}


for (var d in destinations) {
//alert('adding a link from ' + p.name + ' to ' + destinations[d]);
if (linkCount[destinations[d]])
++linkCount[destinations[d]];
else
linkCount[destinations[d]] = 1;
}

p.wordCount = p.strippedContent.trim().replace(/\s+/g, ' ').split(' ').length;

this.passages[p.id] = p;
}


var killList = [];
var connectivityTotal = 0;
this.passageCount = 0
Illume.Story.wordCount = 0;
Illume.Story.tags = {};

for (var i in this.passages) {
p = this.passages[i];
p.inboundLinks = (linkCount[p.name] || 0);
p.connections = p.links + p.inboundLinks;
killList.push(p.name);

Illume.Story.wordCount += p.wordCount;
connectivityTotal += p.connections;
++this.passageCount;

for (var t in p.tags) {
if (!Illume.Story.tags[p.tags[t]])
Illume.Story.tags[p.tags[t]] = 1;
else
++Illume.Story.tags[p.tags[t]];
}
}

for (var n in killList) {
delete(linkCount[killList[n]]);
}

this.averageLength = Illume.Story.wordCount / this.passageCount;
this.averageConnectivity = connectivityTotal / this.passageCount;

this.deadLinks = linkCount;
},

generateSummary:function() {
var ps = this.passages.slice();
var results = {};
var p;

ps.sort(function(a,b) {
if (a.connections < b.connections)
return 1;
if (a.connections > b.connections)
return -1;
return 0;
});

results["header.Passage"] = [
'Length',
'Links (In/Out)'
];

for (var i in ps) {
p = ps[i];
results[p.name] = {
illumeLink:"Illume.UI.showPassage('" + p.id + "');",
wordCount: p.wordCount,
connections: p.connections + " (" + p.inboundLinks + "/" + p.links + ")"
};
}

return results;
},

generateReviewSummary:function() {
var result = {};
var reviewed = this.countPassages(function(p) { return p.reviewed;});
var changed = this.countPassages(function(p) { return p.changed;});

result['totalPassages'] = {
illumeLink:"window.Illume.UI.switchFilter('all');",
value: this.passageCount
}
result['changed'] = {
illumeLink:"window.Illume.UI.switchFilter('changed');",
value: changed
};
result['reviewed'] = {
illumeLink:"window.Illume.UI.switchFilter('reviewed');",
value:reviewed
};
result['reviewCompleted'] = {
illumeLink:"window.Illume.UI.switchFilter('unreviewed');",
value:Math.ceil(reviewed / this.passageCount * 100) + '%'
};



return result;
}

}


window.Illume.Entweedle = {

export: function() {
var output = window.document.getElementById("output");
var buffer = [];

var storyData = window.document.getElementsByTagName("tw-storydata");
if (storyData) {
buffer.push(this.buildPassage("StoryTitle","",storyData[0].getAttribute("name")));
}
var userScript = window.document.getElementById("twine-user-script");
if (userScript) {
buffer.push(this.buildPassage("UserScript","script",userScript.innerHTML));
}

var userStylesheet = window.document.getElementById("twine-user-stylesheet");
if (userStylesheet) {
buffer.push(this.buildPassage("UserStylesheet","stylesheet",userStylesheet.innerHTML));
}

var passages = window.document.getElementsByTagName("tw-passagedata");
for (var i = 0; i < passages.length; i++) {
buffer.push(this.buildPassageFromElement(passages[i]));
}

return buffer.join('');
},


buildPassageFromElement: function(passage) {
var name = passage.getAttribute("name");
if (!name) {
name = "Untitled Passage";
}
var tags = passage.getAttribute("tags");
var content = passage.textContent;

return this.buildPassage(name, tags, content);
},

buildPassage: function(title, tags, content) {
var result = [];

result.push(":: ",title);
if (tags) {
result.push("[",tags,"]");
}
result.push("\r\n", this.scrub(content),"\r\n\r\n");

return result.join('');
},

scrub: function(content) {
content = content.replace(/^::/gm, " ::");
return content;
}
}


window.Illume.init();
}
}

</script>
</head>
<body>
<div id="header">
War on Drugs
</div>
<div id="workspace">
<div id="sidebar">
<div id="links">
<span onclick="window.Illume.Overview.showStoryOverview();">Story Overview</span>
<span onclick="window.Illume.viewChangeList();">View Change List</span>
<span onclick="window.Illume.saveChangeList();">Export Change List...</span>
<span onclick="window.Illume.exportTwee();">Export Twee Source</span>
<span onclick="window.Illume.saveToFile();">Export Illumination...</span>
</div>
<div id="passageListHeader">
<select id="filter" oninput="window.Illume.UI.updateFilterList();" onchange="window.Illume.UI.filterChanged();">
<option value="unreviewed" selected="selected">Unreviewed</option>
<option value="reviewed">Reviewed</option>
<option value="changed">Changed</option>
<option value="unchanged">Unchanged</option>
<option value="orphans">Orphans</option>
<option value="deadEnds">Dead Ends</option>
<option value="passThroughs">Pass-Throughs</option>
<option id="byTagOption" value="byTag">By Tag...</option>
<option value="all">All Passages</option>
</select>
</div>
<div id="passageListContent"><span onclick="window.Illume.UI.showPassage('1');">Start</span><span onclick="window.Illume.UI.showPassage('2');">StoryCaption</span><span onclick="window.Illume.UI.showPassage('3');">Character Select</span><span onclick="window.Illume.UI.showPassage('4');">John Anderson</span><span onclick="window.Illume.UI.showPassage('5');">JA00S</span><span onclick="window.Illume.UI.showPassage('6');">JA10S</span><span onclick="window.Illume.UI.showPassage('7');">JA1A</span><span onclick="window.Illume.UI.showPassage('8');">JA1B</span><span onclick="window.Illume.UI.showPassage('9');">JA2A</span><span onclick="window.Illume.UI.showPassage('10');">JA3A</span><span onclick="window.Illume.UI.showPassage('11');">JA3B</span><span onclick="window.Illume.UI.showPassage('12');">JA3C</span><span onclick="window.Illume.UI.showPassage('13');">JA3D</span><span onclick="window.Illume.UI.showPassage('14');">JA3E</span><span onclick="window.Illume.UI.showPassage('15');">JA3F</span><span onclick="window.Illume.UI.showPassage('16');">JA4A</span><span onclick="window.Illume.UI.showPassage('17');">JA4B</span><span onclick="window.Illume.UI.showPassage('18');">JA4C</span><span onclick="window.Illume.UI.showPassage('19');">JA4D</span><span onclick="window.Illume.UI.showPassage('20');">JA5A</span><span onclick="window.Illume.UI.showPassage('21');">JA5B</span><span onclick="window.Illume.UI.showPassage('22');">JA90S</span><span onclick="window.Illume.UI.showPassage('23');">Jamal Washington</span><span onclick="window.Illume.UI.showPassage('24');">JW00S</span><span onclick="window.Illume.UI.showPassage('25');">JW00S2</span><span onclick="window.Illume.UI.showPassage('26');">JW10S</span><span onclick="window.Illume.UI.showPassage('27');">JW1A</span><span onclick="window.Illume.UI.showPassage('28');">JW1B</span><span onclick="window.Illume.UI.showPassage('29');">JW1C</span><span onclick="window.Illume.UI.showPassage('30');">JW1D</span><span onclick="window.Illume.UI.showPassage('31');">JW20S</span><span onclick="window.Illume.UI.showPassage('32');">JW2A</span><span onclick="window.Illume.UI.showPassage('33');">JW2B</span><span onclick="window.Illume.UI.showPassage('34');">JW2C</span><span onclick="window.Illume.UI.showPassage('35');">JW2D</span><span onclick="window.Illume.UI.showPassage('36');">JW2E</span><span onclick="window.Illume.UI.showPassage('37');">JW2F</span><span onclick="window.Illume.UI.showPassage('38');">JW3A</span><span onclick="window.Illume.UI.showPassage('39');">JW3B</span><span onclick="window.Illume.UI.showPassage('40');">JW3C</span><span onclick="window.Illume.UI.showPassage('41');">JW3D</span><span onclick="window.Illume.UI.showPassage('42');">JW4A</span><span onclick="window.Illume.UI.showPassage('43');">JW4B</span><span onclick="window.Illume.UI.showPassage('44');">JW5A</span><span onclick="window.Illume.UI.showPassage('45');">JW5B</span><span onclick="window.Illume.UI.showPassage('46');">JW90S</span><span onclick="window.Illume.UI.showPassage('47');">Michael Thompson</span><span onclick="window.Illume.UI.showPassage('48');">MT00S</span><span onclick="window.Illume.UI.showPassage('49');">MT1A</span><span onclick="window.Illume.UI.showPassage('50');">MT20S</span><span onclick="window.Illume.UI.showPassage('51');">MT2A</span><span onclick="window.Illume.UI.showPassage('52');">MT2B</span><span onclick="window.Illume.UI.showPassage('53');">MT2C</span><span onclick="window.Illume.UI.showPassage('54');">MT2D</span><span onclick="window.Illume.UI.showPassage('55');">MT2E</span><span onclick="window.Illume.UI.showPassage('56');">MT3A</span><span onclick="window.Illume.UI.showPassage('57');">MT4A</span><span onclick="window.Illume.UI.showPassage('58');">MT5A</span><span onclick="window.Illume.UI.showPassage('59');">MT5B</span><span onclick="window.Illume.UI.showPassage('60');">MT5C</span><span onclick="window.Illume.UI.showPassage('61');">MT5D</span><span onclick="window.Illume.UI.showPassage('62');">MT5E</span><span onclick="window.Illume.UI.showPassage('63');">MT5F</span><span onclick="window.Illume.UI.showPassage('64');">MT5G</span><span onclick="window.Illume.UI.showPassage('65');">MT6A</span><span onclick="window.Illume.UI.showPassage('66');">MT6E</span><span onclick="window.Illume.UI.showPassage('67');">MT80S</span><span onclick="window.Illume.UI.showPassage('68');">MT90S</span><span onclick="window.Illume.UI.showPassage('69');">StoryInit</span></div>
</div>
<div id="contentArea">
<div id="generalOutput" style="display: block;">
<div id="generalHeader">
<div id="generalTitle">Story Overview</div>
</div>
<div id="generalContent"><div class="infoTile tile2x1 "><div class="title">Welcome to Illume</div><div class="content">
<p>
This is the Story Overview, from which you can find general information and statistics about your story.
</p>
<p>
Use the list at the lower-left to filter and view the passages of your 
story, and click on a passage to open it in review mode. While reviewing
 a passage, you can make changes in-place, compare your changed version 
to the original, revert those changes if needed, and flag a passage as 
reviewed to help you keep track of which passages have been reviewed and
 which ones remain.
</p>
<p>
You can use the links at the top left to view a change list, which shows
 all changes made to all passages, or export it to a file. You can also 
save a copy of this illumination for later use, or export your story in 
twee source format.
</p>
<p>
For more information about Illume, visit the <a href="https://maximumverbosity.net/twine/Illume/">Illume web site</a>.
</p>
</div></div><div class="infoTile tile1x1 "><div class="title">Stats</div><div class="content"><table><tbody><tr><td>Format</td><td>SugarCube</td></tr><tr><td><span class="link" onclick="Illume.UI.switchFilter('orphans');">Orphans</span></td><td>2</td></tr><tr><td><span class="link" onclick="Illume.UI.switchFilter('deadEnds');">Dead Ends</span></td><td>2</td></tr><tr><td><span class="link" onclick="Illume.UI.switchFilter('passThroughs');">Pass-throughs</span></td><td>33</td></tr><tr><td><span class="link" onclick="Illume.UI.switchFilter('all');">Passage Count</span></td><td>69</td></tr><tr><td>Word Count</td><td>3269</td></tr><tr><td>Average Links</td><td>2.17</td></tr><tr><td>Average Words</td><td>47.37</td></tr></tbody></table><p>These do not reflect changes made during review or by macros during play.</p></div></div><div class="infoTile tile1x1 "><div class="title">Review Summary</div><div class="content"><table><tbody><tr><td><span class="link" onclick="window.Illume.UI.switchFilter('all');">Total Passages</span></td><td>69</td></tr><tr><td><span class="link" onclick="window.Illume.UI.switchFilter('changed');">Changed</span></td><td>0</td></tr><tr><td><span class="link" onclick="window.Illume.UI.switchFilter('reviewed');">Reviewed</span></td><td>0</td></tr><tr><td><span class="link" onclick="window.Illume.UI.switchFilter('unreviewed');">Review Completed</span></td><td>0%</td></tr></tbody></table></div></div><div class="infoTile tile2x1 "><div class="title">Passage Summary</div><div class="content"><table><tbody><tr class="header"><td> Passage</td><td>Length</td><td>Links (In/Out)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('3');"> Character  Select</span></td><td>49</td><td>13 (10/3)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('26');"> J W10 S</span></td><td>7</td><td>5 (4/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('17');"> J A4 B</span></td><td>54</td><td>4 (1/3)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('52');"> M T2 B</span></td><td>58</td><td>4 (1/3)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('8');"> J A1 B</span></td><td>88</td><td>3 (1/2)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('9');"> J A2 A</span></td><td>136</td><td>3 (1/2)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('11');"> J A3 B</span></td><td>105</td><td>3 (1/2)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('13');"> J A3 D</span></td><td>98</td><td>3 (1/2)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('18');"> J A4 C</span></td><td>44</td><td>3 (2/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('28');"> J W1 B</span></td><td>57</td><td>3 (1/2)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('34');"> J W2 C</span></td><td>43</td><td>3 (1/2)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('35');"> J W2 D</span></td><td>87</td><td>3 (1/2)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('39');"> J W3 B</span></td><td>64</td><td>3 (1/2)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('43');"> J W4 B</span></td><td>68</td><td>3 (1/2)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('44');"> J W5 A</span></td><td>35</td><td>3 (2/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('49');"> M T1 A</span></td><td>108</td><td>3 (1/2)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('55');"> M T2 E</span></td><td>85</td><td>3 (1/2)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('56');"> M T3 A</span></td><td>41</td><td>3 (1/2)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('4');"> John  Anderson</span></td><td>22</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('7');"> J A1 A</span></td><td>104</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('10');"> J A3 A</span></td><td>43</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('19');"> J A4 D</span></td><td>75</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('20');"> J A5 A</span></td><td>54</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('21');"> J A5 B</span></td><td>38</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('22');"> J A90 S</span></td><td>7</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('23');"> Jamal  Washington</span></td><td>22</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('24');"> J W00 S</span></td><td>7</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('25');"> J W00 S2</span></td><td>7</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('27');"> J W1 A</span></td><td>52</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('31');"> J W20 S</span></td><td>7</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('32');"> J W2 A</span></td><td>46</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('33');"> J W2 B</span></td><td>26</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('36');"> J W2 E</span></td><td>53</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('37');"> J W2 F</span></td><td>58</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('38');"> J W3 A</span></td><td>95</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('40');"> J W3 C</span></td><td>88</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('41');"> J W3 D</span></td><td>74</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('42');"> J W4 A</span></td><td>40</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('45');"> J W5 B</span></td><td>48</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('46');"> J W90 S</span></td><td>7</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('47');"> Michael  Thompson</span></td><td>32</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('48');"> M T00 S</span></td><td>7</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('50');"> M T20 S</span></td><td>7</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('51');"> M T2 A</span></td><td>47</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('57');"> M T4 A</span></td><td>41</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('58');"> M T5 A</span></td><td>28</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('61');"> M T5 D</span></td><td>5</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('62');"> M T5 E</span></td><td>6</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('63');"> M T5 F</span></td><td>8</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('64');"> M T5 G</span></td><td>53</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('67');"> M T80 S</span></td><td>7</td><td>2 (1/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('1');"> Start</span></td><td>250</td><td>1 (0/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('5');"> J A00 S</span></td><td>7</td><td>1 (0/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('6');"> J A10 S</span></td><td>7</td><td>1 (0/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('12');"> J A3 C</span></td><td>40</td><td>1 (0/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('14');"> J A3 E</span></td><td>31</td><td>1 (0/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('15');"> J A3 F</span></td><td>38</td><td>1 (0/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('16');"> J A4 A</span></td><td>81</td><td>1 (0/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('29');"> J W1 C</span></td><td>74</td><td>1 (0/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('30');"> J W1 D</span></td><td>49</td><td>1 (0/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('53');"> M T2 C</span></td><td>30</td><td>1 (0/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('54');"> M T2 D</span></td><td>24</td><td>1 (0/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('59');"> M T5 B</span></td><td>28</td><td>1 (0/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('60');"> M T5 C</span></td><td>18</td><td>1 (0/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('65');"> M T6 A</span></td><td>45</td><td>1 (0/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('66');"> M T6 E</span></td><td>57</td><td>1 (0/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('68');"> M T90 S</span></td><td>7</td><td>1 (0/1)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('2');"> Story Caption</span></td><td>41</td><td>0 (0/0)</td></tr><tr><td><span class="link" onclick="Illume.UI.showPassage('69');"> Story Init</span></td><td>1</td><td>0 (0/0)</td></tr></tbody></table></div></div><div class="infoTile tile1x1 "><div class="title">Tags</div><div class="content"><table><tbody><tr class="header"><td>Tag</td><td>Occurences</td></tr><tr><td><span class="tag" onclick="window.Illume.UI.filterByTag('Special-Passage');">Special-Passage</span></td><td>2</td></tr><tr><td><span class="tag" onclick="window.Illume.UI.filterByTag('JA');">JA</span></td><td>19</td></tr><tr><td><span class="tag" onclick="window.Illume.UI.filterByTag('Crossover');">Crossover</span></td><td>4</td></tr><tr><td><span class="tag" onclick="window.Illume.UI.filterByTag('MT');">MT</span></td><td>24</td></tr><tr><td><span class="tag" onclick="window.Illume.UI.filterByTag('JW');">JW</span></td><td>26</td></tr></tbody></table></div></div><div class="infoTile tile1x1 "><div class="title">Tips</div><div class="content">
<p>
Tag a passage "illumeIgnore" and it will be totally ignored by Illume for all purposes.
</p>
<p>
If a passage is not being modified, tag it "illumeReviewed" to set its 
initial state to Reviewed. The editor can still refer back to it if 
needed.
</p>
</div></div></div>
</div>
<div id="passageViewer" style="display: none;">
<div id="passageHeader">
<div id="passageTitle">JA3B</div>
<div id="passageTags"><span class="tag" onclick="window.Illume.UI.filterByTag('JA');">JA</span></div>
</div>
<div id="passageControls">
<div id="dirtyControls" style="display: none;">
Modified <input id="revertChangesButton" type="button" value="Revert" onclick="Illume.Editor.revert();">
</div>
<div id="reviewedControls" style="display: none;">
Reviewed <input id="unreviewedButton" type="button" value="Flag as Unreviewed" onclick="Illume.Editor.setReviewedHandler(false);">
</div>
<div id="unreviewedControls" style="display: inline-block;">
Unreviewed <input id="reviewedButton" type="button" value="Flag as Reviewed" onclick="Illume.Editor.setReviewedHandler(true);">
</div>
</div>
<div id="passageContent">
<div id="editorCorral" style="bottom: 0px;"><textarea id="editor">&lt;img
 src="images/JA3A.JPG"/&gt;
&lt;&lt;ctp "JA"&gt;&gt;
&lt;&lt;ja&gt;&gt;"So they finally legalized it...&lt;&lt;/ja&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"JA"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;ja&gt;&gt;but the same people who got locked up for selling it 
can’t even open a dispensary now?&lt;&lt;/ja&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"JA"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;ja&gt;&gt;Wild.&lt;&lt;/ja&gt;&gt;
&lt;&lt;/ctp&gt;&gt;

Weed has been legal for a few weeks now and Dave is worried about the 
increased risk. The new market is hot right now, but who knows if it 
will stay that way. He thinks you guys should shift to a safer business 
plan and franchise a fast food restaurant. You still see opportunities 
in Cannabis. You see an opportunity to invest on a corporate scale into 
the cannabis industry. Time is running out if you want to get into 
cannabis early, what do you decide?
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Franchise in 
fast food|JA4A][$wealth +=10]]&lt;/div&gt;&lt;/div&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Invest in 
cannabis at a corporate scale|JA3C][$wealth 
+=50]]&lt;/div&gt;&lt;/div&gt;</textarea></div>
<div id="changeViewer" style="display: none;">&lt;img src="images/JA3A.JPG"/&gt;
&lt;&lt;ctp "JA"&gt;&gt;
&lt;&lt;ja&gt;&gt;"So they finally legalized it...&lt;&lt;/ja&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance "JA"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;ja&gt;&gt;but the same people who got locked up for selling it can’t even open a dispensary now?&lt;&lt;/ja&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance "JA"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;ja&gt;&gt;Wild.&lt;&lt;/ja&gt;&gt;
&lt;&lt;/ctp&gt;&gt;

Weed has been legal for a few weeks now and Dave is worried about the increased risk. The new market is hot right now, but who knows if it will stay that way. He thinks you guys should shift to a safer business plan and franchise a fast food restaurant. You still see opportunities in Cannabis. You see an opportunity to invest on a corporate scale into the cannabis industry. Time is running out if you want to get into cannabis early, what do you decide?
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Franchise in fast food|JA4A][$wealth +=10]]&lt;/div&gt;&lt;/div&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Invest in cannabis at a corporate scale|JA3C][$wealth +=50]]&lt;/div&gt;&lt;/div&gt;</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footerRight"></div>
<div id="footerLeft">0 reviewed, 69 remaining (0% reviewed)</div>
</div>
<div id="introText" style="display: none;">
<p>
This is the Story Overview, from which you can find general information and statistics about your story.
</p>
<p>
Use the list at the lower-left to filter and view the passages of your 
story, and click on a passage to open it in review mode. While reviewing
 a passage, you can make changes in-place, compare your changed version 
to the original, revert those changes if needed, and flag a passage as 
reviewed to help you keep track of which passages have been reviewed and
 which ones remain.
</p>
<p>
You can use the links at the top left to view a change list, which shows
 all changes made to all passages, or export it to a file. You can also 
save a copy of this illumination for later use, or export your story in 
twee source format.
</p>
<p>
For more information about Illume, visit the <a href="https://maximumverbosity.net/twine/Illume/">Illume web site</a>.
</p>
</div>
<div id="tips" style="display: none;">
<p>
Tag a passage "illumeIgnore" and it will be totally ignored by Illume for all purposes.
</p>
<p>
If a passage is not being modified, tag it "illumeReviewed" to set its 
initial state to Reviewed. The editor can still refer back to it if 
needed.
</p>
</div>
<div id="storyData" style="display: none;">
<tw-storydata name="War on Drugs" startnode="1" creator="Twine" creator-version="2.10.0" format="SugarCube" format-version="2.37.3" ifid="2F329366-7393-484B-B197-DD974FFD475B" options="" tags="" zoom="1" hidden=""><style role="stylesheet" id="twine-user-stylesheet" type="text/twine-css">/* ---------------IMPORT FONTS-------------- */

/* Monospaced */
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Mono:wght@100..900&display=swap');

/* Serifed */
@import url('https://fonts.googleapis.com/css2?family=Noto+Serif:ital,wght@0,100..900;1,100..900&display=swap');

/* Sans Serif */
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap');

/* Fantasy */
@import url('https://fonts.googleapis.com/css2?family=Megrim&display=swap');

/* Dyslexic */
@import url('https://fonts.cdnfonts.com/css/open-dyslexic');

/* Icons */
@import url('https://use.fontawesome.com/releases/v6.7.2/css/all.css');

/* ---------------FONT SETTINGS-------------- */

.sansserif .passage,
.sansserif #ui-dialog-body {
  font-family: 'Noto Sans', sans-serif;
}

.monospace .passage,
.monospace #ui-dialog-body {
  font-family: 'Noto Sans Mono', monospace;
}

.serif .passage,
.serif #ui-dialog-body {
  font-family: 'Noto Serif', serif;
}

.dyslexic .passage,
.dyslexic #ui-dialog-body {
  font-family: 'Open-Dyslexic', dyslexic;
}

/*Alignment*/
.justified .passage {
  text-align: justify;
}

/*Line Height*/
.lh-small .passage {
  line-height: 1.2;
}

.lh-medium .passage {
  line-height: 1.6;
}

.lh-large .passage {
  line-height: 2;
}

.lh-biggest .passage {
  line-height: 2.4;
}

/* ---------------TEMPLATE SETTINGS------------- */

.center {
  text-align: center;
}

.justify {
  text-align: justify;
}

body {
  padding: 5% 15%;
  background: transparent;
}

html {
  background-color: black;
  background-image: url('images/leaf.jpg');
  background-repeat: repeat;
  background-position: top center;
  background-attachment: fixed;
  background-size: cover;
  height: 100%;
}

a {
  color: white;
}

a:hover {
  color: white;
  text-shadow: 0px 0px 1px black;
}

/* Text box styling */
#passages {
  /* Base size for the font inside the passage */
  font-size: 16px;

  /* Set a maximum width for the textbox */
  max-width: 800px;

  /* An outline around the textbox */
  border: 1px solid black;
  box-shadow: 0px 0px 20px black;

  padding: 20px 30px;

  /* A semi-transparent background color */
  background-color: rgba(0, 0, 0, 0.75);

  /* Space between the edges of the textbox and the text */
  padding: 50px;

  /* Round off the edges of the textbox */
  border-radius: 10px;

  -webkit-animation: fadein 0.7s;
  /* Safari, Chrome and Opera > 12.1 */
  -moz-animation: fadein 0.7s;
  /* Firefox < 16 */
  -ms-animation: fadein 0.7s;
  /* Internet Explorer */
  -o-animation: fadein 0.7s;
  /* Opera < 12.1 */
  animation: fadein 0.7s;
}

@keyframes fadein {
  from {
    opacity: 0;
  }

  to {
    opacity: 1;
  }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
  from {
    opacity: 0;
  }

  to {
    opacity: 1;
  }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
  from {
    opacity: 0;
  }

  to {
    opacity: 1;
  }
}

/* Internet Explorer */
@-ms-keyframes fadein {
  from {
    opacity: 0;
  }

  to {
    opacity: 1;
  }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
  from {
    opacity: 0;
  }

  to {
    opacity: 1;
  }
}

#passages a {
  color: lightblue;
}

#passages a:hover {
  color: white;
  text-decoration: none;
}

.chapterHead h2 {
  text-align: center;
  text-transform: uppercase;
  font-size: 16px;
  letter-spacing: 5px;
}

.chapterHead h1 {
  text-align: center;
  margin-top: 30px;
  font-size: 35px;
}

img {
  max-width: 100%;
  border-radius: 10px;
}

h1 {
  font-family: 'Megrim';
  font-size: 35px;
  letter-spacing: 3px;
  line-height: 40px;
}

h2 {
  font-family: sans-serif;
  font-size: 25px;
  font-weight: 300;
  line-height: 30px;
}

.storychoice {
  font-family: sans-serif;
  font-size: 16px;
  color: white;
  /* display: inline-block; */
  float: center;
  border: 1px solid #555555;
  border-radius: 10px;
  box-shadow: 0px 0px 20px black;
  padding: 10px 15px;
  margin-bottom: 30px;
}

.storychoice:hover {
  background: #262626;
  color: white;
  box-shadow: 0px 0px 10px #474747;
}

.storychoice:visited {
  color: white;
}

.storychoice.visited:hover {
  color: white;
}

.storychoice:before {
  content: '\f595';
  font-family: 'Font Awesome 6 Free';
  font-weight: 900;
  margin-right: 13px;
}

.storychoice:hover::before {
  margin-right: 25px;
  transition: all 0.5s ease;
}

#ui-bar {
  background-color: rgba(0, 0, 0, 0.7);
  color: rgba(255, 255, 255, 1);
  border-right: 1px solid #000;
  text-align: center;
}

#menu ul {
  margin: 0 0;
  padding: 0;
  list-style: none;
  border: 1px solid #000;
}

#menu ul:empty {
  display: none;
}

#menu li {
  margin: 0;
}

#menu li:not(:first-child) {
  border-top: 1px solid #000;
}

#menu li a {
  display: block;
  padding: 0.25em 0.75em;
  border: 1px solid transparent;
  color: #fff;
  text-transform: uppercase;
}

#menu li a:hover {
  background-color: rgba(0, 0, 0, 0.25);
  border-color: #fff;
}

#ui-bar-toggle,
#ui-bar-history [id|='history'] {
  background-color: rgba(0, 0, 0, 0.25);
  border-color: #000;
}

#ui-bar-toggle:hover {
  background-color: rgba(0, 0, 0, 0.25);
  border-color: #fff;
}

#ui-bar-history [id|='history']:hover {
  background-color: rgba(0, 0, 0, 0.25);
  border-color: #fff;
}

#story-title {
  padding: 25px 0px 0px 0px;
  font-family: 'Megrim', sans-serif;
}

/*NOTEBOXS AND SPECIAL DIVS*/

.notebox {
  background-color: rgba(38, 38, 38, 0.25);
  padding: 15px;
  margin: 10px 0px;
  text-align: center;
  font-family: sans-serif;
  font-size: 15px;
  line-height: 25px;
  border-radius: 10px;
}

.notebox i {
  font-size: 15px;
  margin-right: 20px;
}

.warningbox {
  background-color: rgba(0, 0, 0, 0.5);
  border: 1px solid black;
  padding: 30px;
  margin: 10px 0px;
  text-align: center;
  font-family: sans-serif;
  font-size: 15px;
  line-height: 17px;
  border-radius: 10px;
}

.warningbox h2 {
  font-size: 23px;
}

.itemadd {
  background-color: #26c35a;
  padding: 5px 10px;
  text-align: center;
  font-weight: 500;
  font-family: sans-serif;
  font-size: 16px;
  border-radius: 10px;
  display: inline-block;
  margin: 10px auto;
}

.itemlost {
  background-color: #c3263c;
  padding: 5px 10px;
  text-align: center;
  font-weight: 500;
  font-family: sans-serif;
  font-size: 16px;
  border-radius: 10px;
  display: inline-block;
  margin: 10px auto;
}

/* ------------ADDITIONS TO TEMPLATE-----------*/

#passages button {
    cursor: pointer;
    border: 2px solid #add9e6;
    font-family: Raleway;
    font-size: 12px;
    color: rgb(255, 255, 255);
    padding: 5px 10px;
    transition: all;
    width: 80px;
    border-radius: 8px;
    background: rgb(000, 000, 000);
    font-weight: 600;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: row-reverse;
}


#passages button:hover {

    color: rgb(255, 255, 255);
    width: 85px;
    background: rgb(000, 000, 000);
    border-color: rgb(255, 204, 102);
    border-width: 2px;
    border-style: solid;
}

#passages button:after {
    content: '\f55f';
    font-family: 'Font Awesome 5 Free';
    font-weight: 700;
    margin-right: 13px;
}

/* ------------STATUS/PROGRESS BARS----------- */

.progress-bar {
    width: 100%;
    height: 15px;
    background: #343434;
    opacity: 0.6;
    border-radius: 10px;
    margin: -20px 0;
}

.progress-bar div {
    height: 100%;
    border-radius: 10px;
}

#status-bars p {
    margin-bottom: 2px;
    font-size: 1.00em;
    text-align: left;
}

/* ---------------SPEECH BOXES-------------- */

.say {
    border: 1px solid #555555;
    border-radius: 10px;
    overflow: auto;
}

.say>img {
    max-width: 20%;
    float: left;
    margin-right: 1em;
}

.say>p:first-of-type {
    font-weight: bold;
    margin: 0.2em 0;
    border-bottom: 1px solid #555555;
}

.say>p:last-of-type {
    padding: 0.5em;
    margin: 0;
}</style><script role="script" id="twine-user-script" type="text/twine-javascript">//-------------FONT CHOICE SETTINGS------------//

var settingFontFamily = ['Sans Serif', 'Serif', 'Monospace', 'Open Dyslexic']
var fontFamily = function () {
  var $html = $('html')
  $html.removeClass('sansserif serif monospace dyslexic')

  switch (settings.fontFamily) {
    case 'Sans Serif':
      $html.addClass('sansserif')
      break
    case 'Serif':
      $html.addClass('serif')
      break
    case 'Monospace':
      $html.addClass('monospace')
      break
    case 'Open Dyslexic':
      $html.addClass('dyslexic')
      break
  }
}
Setting.addList('fontFamily', {
  label: 'Change font type',
  desc: 'Choose between a Serif, Sans-serif, or the OpenDyslexic Font',
  list: settingFontFamily,
  default: 'Sans Serif',
  onInit: fontFamily,
  onChange: fontFamily,
})

/* font size */

var settingFontSize = ['75%', '100%', '125%', '150%']
var resizeFont = function () {
  var size = document.getElementById('passages')
  switch (settings.fontSize) {
    case '75%':
      size.style.fontSize = '75%'
      break
    case '100%':
      size.style.fontSize = '100%'
      break
    case '125%':
      size.style.fontSize = '125%'
      break
    case '150%':
      size.style.fontSize = '150%'
      break
  }
}
Setting.addList('fontSize', {
  label: 'Change Font Size',
  list: settingFontSize,
  default: '100%',
  onInit: resizeFont,
  onChange: resizeFont,
})

/* line height */

var settingLineHeight = ['75%', '100%', '125%', '150%']
var lineHeight = function () {
  var $html = $('html')
  $html.removeClass('lh-small lh-medium lh-large lh-biggest')
  switch (settings.lineheight) {
    case '75%':
      $html.addClass('lh-small')
      break
    case '100%':
      $html.addClass('lh-medium')
      break
    case '125%':
      $html.addClass('lh-large')
      break
    case '150%':
      $html.addClass('lh-biggest')
      break
  }
}
Setting.addList('lineheight', {
  label: 'Change Line Height',
  default: '100%',
  list: settingLineHeight,
  onInit: lineHeight,
  onChange: lineHeight,
})

/* justification */

var settingtextAlign = function () {
  if (settings.textalign) {
    $('html').addClass('justified')
  } else {
    $('html').removeClass('justified')
  }
}
Setting.addToggle('textalign', {
  label: 'Change Text Alignment',
  desc: 'If enabled, the text will be justified',
  default: false,
  onInit: settingtextAlign,
  onChange: settingtextAlign,
})

//-------------KEYBOARD NAVIGATION------------//

var KBIntervalID = 0;
$(document).on(":passagerender", function (ev) {
    clearInterval(KBIntervalID);
    UpdateLinks(ev.content);
    // Search passages for links every 300ms, just in case they get updated, and marks them for key clicks
    KBIntervalID = setInterval(UpdateLinks, 300);
});
// Adds key shortcut indicators to links in passage if there are less than 11 links in the passsage.
function UpdateLinks(Container) {
    // Enables keyboard shortcuts on passages that do not have the "DisableKeyLinks" tag
    if (!tags().includes("DisableKeyLinks")) {
        var Links, i;
        if (typeof Container === "undefined") {
            Container = document;
            Links = $("#passages a").toArray();
        } else {
            Links = $(Container).find("a").toArray();
        }
        if (Links.length > 0) {
            for (i = Links.length - 1; i >= 0; i--) {
                if ($(Links[i]).data("nokeys") || $(Links[i]).parent().data("nokeys")) {
                    Links.deleteAt(i);
                }
            }
        }
        if (Links.length === 1) {
            if (!Links[0].id.includes("Link")) {
                Links[0].id = "NextLink";
            }
        } else if (Links.length >= 1 && Links.length <= 10) {
            var n = 1;
            for (i = 0; i < Links.length; i++) {
                if (!Links[i].id.includes("Link")) {
                    while ($(Container).find("#Link" + n).length) {
                        ++n;
                        if (n > 10) {
                            break;
                        }
                    }
                    if (n < 10) {
                        $("<sup>[" + n + "]</sup>").appendTo(Links[i]);
                        Links[i].id = "Link" + n;
                    } else if (n === 10) {
                        $("<sup>[0]</sup>").appendTo(Links[i]);
                        Links[i].id = "Link0";
                        break;
                    } else {
                        break;
                    }
                }
            }
        }
    }
}
$(document).on("keyup", function (e) {
    // Enables keyboard shortcuts on passages that do not have the "DisableKeyLinks" tag
    if (!tags().includes("DisableKeyLinks") && ($("input:focus").length === 0)) {
        // Trigger next link click on right arrow key or "1" (normal and numpad)
        if (((e.key == "ArrowRight") || (e.key == "1") || (e.keyCode === 97)) && ($("#NextLink").length > 0)) {
            if (!(tags().includes("IgnoreArrowKeys") && (e.key == "ArrowRight"))) {
                e.preventDefault();
                $("#NextLink").click();
                return false;
            }
        } else {
            // Trigger link click on keys "0" through "9"
            if ((e.keyCode > 47) && (e.keyCode < 58)) {
                if ($("#Link" + (e.keyCode - 48)).length) {
                    e.preventDefault();
                    $("#Link" + (e.keyCode - 48)).click();
                    return false;
                }
            }
            // Trigger link click on numpad keys "0" through "9"
            if ((e.keyCode > 95) && (e.keyCode < 106)) {
                if ($("#Link" + (e.keyCode - 96)).length) {
                    e.preventDefault();
                    $("#Link" + (e.keyCode - 96)).click();
                    return false;
                }
            }
        }
        // Trigger random click on "." or "r" key
        if ((e.key == ".") || (e.key == "r")) {
            e.preventDefault();
            var Links = $("#passages a"), n, UsableLinks = [];
            if (Links.length > 0) {
                for (n = 0; n < Links.length; n++) {
                    if (!$(Links[n]).data("nokey")) {
                        UsableLinks.push(n);
                    }
                }
                if (UsableLinks.length > 0) {
                    n = random(UsableLinks.length - 1);
                    Links[UsableLinks[n]].click();
                    return false;
                }
            }
        }
        // Trigger back click on left arrow key or backquote
        if ((e.key == "ArrowLeft") || (e.key == "`")) {
            if ((!tags().includes("IgnoreArrowKeys")) || (e.key != "ArrowLeft")) {
                e.preventDefault();
                Engine.backward();
                return false;
            }
        }
    }
});

//-------------STATUS/PROGRESS BARS------------//

window.updateBars = function () {
    let sysdis = State.variables.sysdis || 0;
    let legal = State.variables.legal || 0;
    let wealth = State.variables.wealth || 0;
    let health = State.variables.health || 0;

    // Normal scale: Higher = More Danger
    function getStandardBarColor(value) {
        if (value <= 30) return "SpringGreen";
        if (value <= 60) return "Gold";
        return "Tomato";
    }

    // Inverted scale: Lower = More Danger
    function getInvertedBarColor(value) {
        if (value >= 70) return "SpringGreen";
        if (value >= 40) return "Gold";
        return "Tomato";
    }

    function updateBar(barId, value, colorFunction) {
        let barElement = document.getElementById(barId);
        if (barElement) {
            barElement.style.width = value + "%";
            barElement.style.background = colorFunction(value);
        }
    }

    updateBar("sysdis-bar", sysdis, getStandardBarColor);
    updateBar("legal-bar", legal, getStandardBarColor);
    updateBar("wealth-bar", wealth, getInvertedBarColor);
    updateBar("health-bar", health, getInvertedBarColor);
};

$(document).on(':passageend', updateBars);

//---------------SPEECH BOX MACRO--------------//

;(function () {
  // v1.1.1
  'use strict'

  var characters = new Map()

  function addCharacter(name, displayname, icon) {
    if (icon === undefined && displayname) {
      icon = displayname
      displayname = null
    }
    if (State.length) {
      throw new Error('addCharacter() -> must be called before story starts')
    }
    if (!name || !icon) {
      console.error('addCharacter() -> invalid arguments')
      return
    }
    if (characters.has(name)) {
      console.error('addCharacter() -> overwriting character "' + name + '"')
    }
    characters.set(name, { displayName: displayname, image: icon })
  }

  function say($output, character, text, imgSrc) {
    //
    var $box = $(document.createElement('div')).addClass(
      Util.slugify(character) + ' say'
    )

    // portrait
    var _img = characters.has(character)
      ? characters.get(character).image
      : null
    var $img = $(document.createElement('img')).attr(
      'src',
      imgSrc || _img || ''
    )

    if ($img.attr('src') && $img.attr('src').trim()) {
      $box.append($img)
    }

    // name and content boxes
    var _name = character.toUpperFirst()
    if (characters.has(character) && characters.get(character).displayName) {
      _name = characters.get(character).displayName
    }

    $box
      .append($(document.createElement('p')).wiki(_name))
      .append($(document.createElement('p')).wiki(text))

    if ($output) {
      if (!($output instanceof $)) {
        $output = $($output)
      }
      $box.appendTo($output)
    }

    return $box
  }

  setup.say = say
  setup.addCharacter = addCharacter

  Macro.add('character', {
    // character macro
    handler: function () {
      addCharacter(this.args[0], this.args[1], this.args[2])
    },
  })

  $(document).one(':passagestart', function () {
    // construct array of character names
    var names = Array.from(characters.keys())
    names.push('say')
    // generate macros
    Macro.add(names, {
      tags: null,
      handler: function () {
        if (this.name !== 'say') {
          say(this.output, this.name, this.payload[0].contents)
        } else {
          say(this.output, this.args[0], this.payload[0].contents, this.args[1])
        }
      },
    })
  })
})()

//-------------CLICK TO PROCEED MACRO------------//

;(() => {
  'use strict'

  $(document).on(':passageinit', () => {
    CTP.Logs.forEach((_, id) => {
      if (!CTP.Repository.get(id)?.persist) CTP.Logs.delete(id)
    })
    CTP.Repository.forEach(({ persist }, id) => {
      if (!persist) CTP.Repository.delete(id)
    })
  })

  var CTP = class _CTP {
    constructor(id, persist = false) {
      this.stack = []
      this.clears = []
      this.options = {}
      if (!id?.trim()) throw new Error(`No ID specified!`)
      this.id = id
      this.persist = persist
      _CTP.Repository.set(id, this)
    }
    static get Repository() {
      if (!setup['@CTP/Repository']) setup['@CTP/Repository'] = new Map()
      return setup['@CTP/Repository']
    }
    static get Logs() {
      if (!variables()['@CTP/Logs']) variables()['@CTP/Logs'] = new Map()
      return variables()['@CTP/Logs']
    }
    get log() {
      if (!_CTP.Logs.get(this.id))
        _CTP.Logs.set(this.id, { lastClear: -1, index: -1, seen: -1 })
      return _CTP.Logs.get(this.id)
    }
    static getCTP(id) {
      return _CTP.Repository.get(id)
    }
    add(content, options = {}) {
      if (options.clear) this.clears.push(this.stack.length)
      this.stack.push({
        options,
        content,
        index: this.stack.length,
        element: $(),
      })
      return this
    }
    print(index) {
      const { content, options: iOpts } = this.stack[index]
      const options = {
        ...this.options,
        ...iOpts,
      }
      const element = $(document.createElement(options.element || 'span'))
        .addClass('--macro-ctp-hidden')
        .attr({
          'data-macro-ctp-id': this.id,
          'data-macro-ctp-index': index,
        })
        .on('update-internal.macro-ctp', (event, firstTime) => {
          if ($(event.target).is(element)) {
            if (index === this.log.index) {
              if (firstTime) {
                if (typeof content === 'string') element.wiki(content)
                else element.append(content)
                element.addClass(options.transition ? '--macro-ctp-t8n' : '')
              }
              element.removeClass('--macro-ctp-hidden')
            } else {
              if (index < this.log.seen) element.removeClass('--macro-ctp-t8n')
              element.toggleClass(
                '--macro-ctp-hidden',
                index > this.log.index || index < this.log.lastClear
              )
            }
          }
        })
      this.stack[index].element = element
      return element
    }

    output() {
      const wrapper = document.createDocumentFragment()
      for (let i = 0; i < this.stack.length; i++) {
        this.print(i).appendTo(wrapper)
      }
      return wrapper
    }

    advance() {
      if (this.log.index < this.stack.length - 1) {
        this.log.index++
        const firstTime = this.log.index > this.log.seen
        this.log.seen = Math.max(this.log.seen, this.log.index)
        this.log.lastClear =
          this.clears
            .slice()
            .reverse()
            .find(el => el <= this.log.index) ?? -1
        $(document).trigger('update.macro-ctp', [
          'advance',
          this.id,
          this.log.index,
        ])
        this.stack.forEach(({ element }) =>
          element.trigger('update-internal.macro-ctp', [
            firstTime,
            'advance',
            this.id,
            this.log.index,
          ])
        )
      }
      return this
    }

    back() {
      if (this.log.index > 0) {
        this.log.index--
        this.log.lastClear =
          this.clears
            .slice()
            .reverse()
            .find(el => el <= this.log.index) ?? -1
        $(document).trigger('update.macro-ctp', [
          'back',
          this.id,
          this.log.index,
        ])
        this.stack.forEach(({ element }) =>
          element.trigger('update-internal.macro-ctp', [
            false,
            'back',
            this.id,
            this.log.index,
          ])
        )
      }
      return this
    }
  }
  window.CTP = CTP

  Macro.add('ctp', {
    tags: ['ctpNext'],
    handler() {
      const id = this.args[0]
      const persist = this.args.slice(1).includes('persist')
      const ctp = new CTP(id, persist)
      const _passage = passage()
      this.payload.forEach(({ args, name, contents }) => {
        const options = {}
        if (args.includes('clear')) options.clear = true
        if (args.includesAny('t8n', 'transition')) options.transition = true
        const elementArg = args.find(el => el.startsWith('element:')) ?? ''
        if (elementArg) options.element = elementArg.replace('element:', '')
        if (name === 'ctp') ctp.options = { ...options }
        ctp.add(contents, options)
      })
      $(this.output).append(ctp.output())

      if (_passage === passage()) {
        const i = Math.max(ctp.log.index, 0)
        ctp.log.index = -1
        ctp.log.seen = -1
        while (ctp.log.index < i) ctp.advance()
      }
    },
  })

  Macro.add('ctpAdvance', {
    handler() {
      const id = this.args[0]
      if (id) {
        const ctp = CTP.getCTP(id)
        if (ctp) ctp.advance()
        else throw new Error(`No CTP with ID '${id}' found!`)
      } else throw new Error(`No ID specified!`)
    },
  })

  Macro.add('ctpBack', {
    handler() {
      const id = this.args[0]
      if (id) {
        const ctp = CTP.getCTP(id)
        if (ctp) ctp.back()
        else throw new Error(`No CTP with ID '${id}' found!`)
      } else throw new Error(`No ID specified!`)
    },
  })
})()

//--------------VIDEO HELPER---------------------//

Macro.add('video', {
    handler: function () {
        if (this.args.length < 1) {
            return this.error("The video macro requires a path argument.");
        }

        const videoPath = this.args[0];
        let videoWidth = '100%';
        let videoType;
        let additionalAttributes = [];

        // Check if the second argument is a width or a video attribute
        if (this.args[1] && !this.args[1].includes('=')) {
            if (!this.args[1].includes('autoplay') && !this.args[1].includes('loop') && !this.args[1].includes('muted') && !this.args[1].includes('controls')) {
                videoWidth = this.args[1];
                additionalAttributes = this.args.slice(2);
            } else {
                additionalAttributes = this.args.slice(1);
            }
        } else {
            additionalAttributes = this.args.slice(1);
        }

        // Determine the video type based on the file extension
        if (videoPath.endsWith('.mp4')) {
            videoType = 'video/mp4';
        } else if (videoPath.endsWith('.webm')) {
            videoType = 'video/webm';
        } else if (videoPath.endsWith('.mov')) {
            videoType = 'video/mp4';
        } else if (videoPath.endsWith('.ogg')) {
            videoType = 'video/ogg';
        } else if (videoPath.endsWith('.avi')) {
            videoType = 'video/x-msvideo';
        } else {
            return this.error("Unsupported video format.");
        }

        const additionalAttributesStr = additionalAttributes.join(' ');

        const videoHTML = `<video width="${videoWidth}" ${additionalAttributesStr}>
                              <source src="${videoPath}" type="${videoType}">
                              Your browser does not support the video tag.
                           </video>`;

        new Wikifier(this.output, videoHTML);
    }
});</script><tw-tag name="Special-Passage" color="red"></tw-tag><tw-tag name="MT" color="purple"></tw-tag><tw-tag name="JW" color="orange"></tw-tag><tw-tag name="JA" color="green"></tw-tag><tw-tag name="Crossover" color="blue"></tw-tag><tw-passagedata pid="1" name="Start" tags="" position="400,100" size="100,100">&lt;div
 
class="chapterHead"&gt;&lt;h2&gt;Introduction&lt;/
h2&gt;&lt;hr&gt;&lt;h1&gt;The War on Drugs&lt;/h1&gt;&lt;/div&gt;
&lt;img src="images/SKYLINE.JPG" alt="The Denver skyline with Rocky 
Mountains in the background."&gt;
&lt;div class="notebox"&gt;
&lt;hr&gt;
&lt;div class="chapterHead"&gt;&lt;h2&gt;Overview&lt;/h2&gt;
This simulation gives you the opportunity to see small glimpses of life 
and the world through the eyes of three very different people growing up
 in the same general area. 

Play as all three characters, pause and reflect on what you've 
experienced, and remember that you're only seeing small scenes from 
their lives.

Imagine what the "big picture" must have been like for each of 
them.&lt;/div&gt;
&lt;hr&gt;
&lt;div class="chapterHead"&gt;&lt;h2&gt;Navigation&lt;/h2&gt;
The simulation was created to make navigation easy. Mouse-clicking 
should be intuitive, with choices clearly labeled.

The left arrow key can be used to go back. The right arrow key can be 
used to go forward if there is only one choice.

If a choice has a number after it, that number key on the keyboard will 
take you there.&lt;/div&gt;
&lt;hr&gt;
&lt;div class="chapterHead"&gt;&lt;h2&gt;Bookmarks&lt;/h2&gt;
You are free to bookmark your place at any point using the SAVES menu in
 the sidebar. You can come back and load your saves later.

Bookmarks are stored by your browser and aren't shared from one browser 
to another.&lt;/div&gt;
&lt;hr&gt;
&lt;div class="chapterHead"&gt;&lt;h2&gt;Restart&lt;/h2&gt;
The Restart button will reset everything. It will be as if you had not 
checked out any of the characters' stories.

Careful with this one!&lt;/div&gt;
&lt;hr&gt;
&lt;div class="chapterHead"&gt;&lt;h2&gt;Note&lt;/h2&gt;
This simulation includes themes of drugs and drug use, life and death, 
racism, and capitalism.

Viewer discretion is advised.&lt;/div&gt;
&lt;/div&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Select a 
Character|Character Select]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="2" name="StoryCaption" tags="Special-Passage" position="200,100" size="100,100">&lt;div id="status-bars"&gt;
    &lt;p&gt;&lt;i class="fas fa-balance-scale" style="font-size: 1.75em;"&gt;&lt;/i&gt;&amp;emsp;SYS DISADVANTAGE&lt;/p&gt;
    &lt;div class="progress-bar"&gt;&lt;div id="sysdis-bar"&gt;
    &lt;/div&gt;&lt;/div&gt;

    &lt;p&gt;&lt;i class="fas fa-gavel" style="font-size: 1.75em;"&gt;&lt;/i&gt;&amp;emsp;LEGAL TROUBLE&lt;/p&gt;
    &lt;div class="progress-bar"&gt;&lt;div id="legal-bar"&gt;
    &lt;/div&gt;&lt;/div&gt;

    &lt;p&gt;&lt;i class="fas fa-piggy-bank" style="font-size: 1.75em;"&gt;&lt;/i&gt;&amp;emsp;WEALTH&lt;/p&gt;
    &lt;div class="progress-bar"&gt;&lt;div id="wealth-bar"&gt;
    &lt;/div&gt;&lt;/div&gt;

    &lt;p&gt;&lt;i class="fas fa-heartbeat" style="font-size: 1.75em;"&gt;&lt;/i&gt;&amp;emsp;HEALTH&lt;/p&gt;
    &lt;div class="progress-bar"&gt;&lt;div id="health-bar"&gt;
    &lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;</tw-passagedata><tw-passagedata pid="3" name="Character Select" tags="" position="800,100" size="100,100">&lt;&lt;set $sysdis to 0&gt;&gt;
&lt;&lt;set $legal to 0&gt;&gt;
&lt;&lt;set $wealth to 0&gt;&gt;
&lt;&lt;set $health to 0&gt;&gt;
&lt;div class="chapterHead"&gt;&lt;h2&gt;Introduction&lt;/h2&gt;&lt;hr&gt;&lt;h1&gt;Choose Your Character&lt;/h1&gt;&lt;/div&gt;
&lt;img src="images/TRIP.PNG" alt="Michael Thompson, John Anderson, and Jamal Washington as young men."&gt;
Jump in and experience all three characters in whichever order you like.

Every ending will bring you back to this page.
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Michael Thompson]]&lt;/div&gt;&lt;/div&gt; 
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[John Anderson]]&lt;/div&gt;&lt;/div&gt; 
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Jamal Washington]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="4" name="John Anderson" tags="JA" position="1400,300" size="100,100">&lt;&lt;set $sysdis to 0&gt;&gt;
&lt;&lt;set $legal to 0&gt;&gt;
&lt;&lt;set $wealth to 90&gt;&gt;
&lt;&lt;set $health to 80&gt;&gt;
&lt;div class="chapterHead"&gt;&lt;h2&gt;Scene 3&lt;/h2&gt;&lt;hr&gt;&lt;h1&gt;John Anderson&lt;/h1&gt;&lt;/div&gt;
&lt;img src="images/JA0A.JPG" alt="John Anderson as a young man."&gt;
&lt;div class="notebox"&gt;
!!! Bio Facts
&lt;&lt;type 60ms&gt;&gt;&lt;b&gt;Year of Birth:  &lt;/b&gt;1968&lt;&lt;/type&gt;&gt;
&lt;&lt;type 60ms&gt;&gt;&lt;b&gt;Place of Birth:  &lt;/b&gt;Aspen, Colorado&lt;&lt;/type&gt;&gt;
&lt;&lt;type 60ms&gt;&gt;&lt;b&gt;Race:  &lt;/b&gt;White&lt;&lt;/type&gt;&gt;
&lt;&lt;type 60ms&gt;&gt;&lt;b&gt;Occupation:  &lt;/b&gt;Inherited Business&lt;&lt;/type&gt;&gt;
&lt;&lt;type 60ms&gt;&gt;&lt;b&gt;Education:  &lt;/b&gt;Ivy-League Graduate&lt;&lt;/type&gt;&gt;
&lt;&lt;type 60ms&gt;&gt;&lt;b&gt;Income:  &lt;/b&gt;Wealthy&lt;&lt;/type&gt;&gt;
&lt;/div&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[John Anderson|JA90S]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="5" name="JA00S" tags="JA" position="1500,550" size="100,100">&lt;div class="chapterHead"&gt;&lt;h2&gt;Social Context&lt;/h2&gt;&lt;hr&gt;&lt;h1&gt;The 2000s&lt;/h1&gt;&lt;/div&gt;
&lt;&lt;video "videos/02-Gun.mp4" controls&gt;&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Continue|JA2A]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="6" name="JA10S" tags="JA" position="1500,675" size="100,100">&lt;div class="chapterHead"&gt;&lt;h2&gt;Social Context&lt;/h2&gt;&lt;hr&gt;&lt;h1&gt;The 2010s&lt;/h1&gt;&lt;/div&gt;
&lt;&lt;video "videos/06-Flat.mp4" controls&gt;&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Continue|JA3A]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="7" name="JA1A" tags="JA" position="1500,425" size="100,100">&lt;img
 src="images/JA1A.JPG"/&gt;
You just graduated from cornell with a business degree. Money has never 
been a worry for you. Your dad inherited his dads real estate business, 
and they expect you to take it over next. This is a safe option but you 
have dreams of something else. Cannabis just got legalized in colorado 
and you hope to get in on the ground floor and start a new empire. Your 
dad disagress with your plan, he knows theres no risk in his real estate
 business. He asks to talk to you when you get back to Aspen from 
Cornell. 
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Talk to 
father|JA1B]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="8" name="JA1B" tags="JA" position="1625,425" size="100,100">&lt;img
 src="images/JA1B.JPG"/&gt;
You meet with your father in his estate in Aspen:
&lt;&lt;ctp "JAandJAdad"&gt;&gt;
&lt;&lt;jadad&gt;&gt;John, your grandfather made his fortune in real 
estate.&lt;&lt;/jadad&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"JAandJAdad"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;jadad&gt;&gt;We don’t take risks.&lt;&lt;/jadad&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"JAandJAdad"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;ja&gt;&gt;Yeah, but this is the future, Dad.&lt;&lt;/ja&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"JAandJAdad"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;ja&gt;&gt;If it flops, the government will protect 
us.&lt;&lt;/ja&gt;&gt;
You think they’ll do that for people like Michael Thompson?
&lt;&lt;/ctp&gt;&gt;

You hear his advice but you know theres money to be made in cannabis. 
Didn't grandpa have to take a risk at some point?
Its time to make your decision. Do you play it safe and keep working in 
the family business? Or do you invest in cannabis early?
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Take over 
real estate business|JA00S][$wealth +=30, $health 
+=10]]&lt;/div&gt;&lt;/div&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Invest in 
cannabis early|JA00S][$wealth +=50]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="9" name="JA2A" tags="JA" position="1625,550" size="100,100">&lt;img
 src="images/JA2A.JPG"/&gt;
Cannabis is still illegal federally but in some states the medical 
sector is profitable. You get a call from Dave, your friend from 
Cornell. You guys always talked about investing together, maybe now is 
the perfect time?
Dave flies into Aspen and you show him the beauties of Colorado. Before 
long business talks begin and Dave agrees, theres less risk for you 
guys. 

&lt;&lt;ctp "JAandJAfriend"&gt;&gt;
&lt;&lt;jafriend&gt;&gt;This new medical marijuana industry is 
risky…&lt;&lt;/jafriend&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"JAandJAfriend"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;jafriend&gt;&gt;but let’s be real; we aren’t the ones getting 
arrested for this.&lt;&lt;/jafriend&gt;&gt;
&lt;&lt;/ctp&gt;&gt;
You know he is right, no matter how bad it feels. You know theres long 
been injustice surronding cannabis in different communities. Dave leaves
 Aspen the next day, you still haven't given him your decision yet. You 
haven't decided yet yourself. 
Do you play it safe in a retail business or take a risk and invest in 
medical marijuana?
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Real 
Estate|JA10S][$wealth +=20]]&lt;/div&gt;&lt;/div&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[medical 
marijuana|JA10S][$wealth +=40, $sysdis +=5]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="10" name="JA3A" tags="JA" position="1625,675" size="100,100">&lt;img
 src="images/JA3A.JPG"/&gt;
Its 2014, an amendment got passed in 2012 in Colorado, allowing for the 
sell of recreational cannabis. Big investors dominate from the start, 
they have the captial to open lots of dispensaries without worrying 
about profit right away. 
&lt;div class="center"&gt;&lt;div 
class="storychoice"&gt;[[JA3B]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="11" name="JA3B" tags="JA" position="1750,675" size="100,100">&lt;img
 src="images/JA3A.JPG"/&gt;
&lt;&lt;ctp "JA"&gt;&gt;
&lt;&lt;ja&gt;&gt;"So they finally legalized it...&lt;&lt;/ja&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"JA"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;ja&gt;&gt;but the same people who got locked up for selling it 
can’t even open a dispensary now?&lt;&lt;/ja&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"JA"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;ja&gt;&gt;Wild.&lt;&lt;/ja&gt;&gt;
&lt;&lt;/ctp&gt;&gt;

Weed has been legal for a few weeks now and Dave is worried about the 
increased risk. The new market is hot right now, but who knows if it 
will stay that way. He thinks you guys should shift to a safer business 
plan and franchise a fast food restaurant. You still see opportunities 
in Cannabis. You see an opportunity to invest on a corporate scale into 
the cannabis industry. Time is running out if you want to get into 
cannabis early, what do you decide?
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Franchise in 
fast food|JA4A][$wealth +=10]]&lt;/div&gt;&lt;/div&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Invest in 
cannabis at a corporate scale|JA3C][$wealth 
+=50]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="12" name="JA3C" tags="JA" position="1675,800" size="100,100">&lt;img
 src="images/JA3C.JPG"/&gt;
You've decided that you're committed to investing in the cannabis 
industry. Your dad is displeased with your decision and urges you to 
reconsider. He thinks the risk is too great in a new industry. 
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Risk 
assesment|JA3D]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="13" name="JA3D" tags="JA" position="1800,800" size="100,100">&lt;img
 src="images/JA3C.JPG"/&gt;
&lt;div class="notebox"&gt;
THE DENVER POST
&lt;hr&gt;
&lt;&lt;type 60ms&gt;&gt;Black communities faced higher incarceration 
rates for cannabis, but now wealthy investors are swooping 
in.&lt;&lt;/type&gt;&gt;
&lt;hr&gt;
&lt;/div&gt;

Your dad knows now that you are committed to the cannabis industry and 
tries to form a compromise. He wants you to start small, maybe as a 
partial owner of one dispensary. You still think there is fortunes to be
 made in the new market. You want to go all-in and start your own chain 
of dispensaries. You have the capital to open multiple stores and 
compete with local dispensary prices. 
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Small scale 
investments|JA3E][$wealth +=30]]&lt;/div&gt;&lt;/div&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Go all-in and
 fund dispensary chain|JA3F][$wealth +=50, $sysdis 
+=5]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="14" name="JA3E" tags="JA" position="1700,925" size="100,100">&lt;img
 src="images/JA3E.JPG"/&gt;
&lt;&lt;ja&gt;&gt;"This industry is blowing up. I’d be stupid not to get
 in… but I gotta be careful. Politics change fast."&lt;&lt;/ja&gt;&gt;
Your dad is happy with your decision. At least now if this experiment 
fails, you can still fall back on the families real estate company. 
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[News 
segment|JA4C]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="15" name="JA3F" tags="JA" position="1825,925" size="100,100">&lt;img
 src="images/JA3F.JPG"/&gt;
You take your dads advice into consideration, but you know this is worth
 the risk. You use most of the capital you have and use it to fund a 
chain of dispensaries.
&lt;&lt;ja&gt;&gt;"Money’s about timing, and I’m ahead of the curve. 
Funny how something illegal yesterday makes you rich today—if you’re the
 right kind of person."&lt;&lt;/ja&gt;&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[News 
segment|JA4C]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="16" name="JA4A" tags="JA" position="1550,800" size="100,100">&lt;img
 src="images/JA4A.JPG"/&gt;
You decide to listen to your dads advice, he has successfuly ran a 
business for decades. This option avoids the risk and when your dad is 
ready to retire, you can take over the main business. Using your dads 
real estate connections you start buying buildings to turn them into 
subway restaurants. The new stores quickly start making a profit. Its 
nothing compared to what your dads business makes, but at least this is 
yours. 
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[News 
report|JA4B]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="17" name="JA4B" tags="JA" position="1550,925" size="100,100">&lt;img src="images/JA4B.JPG"/&gt;
“They finally got their foot in the door, and the big guys still locked them out.”
News Report: exposé on social-equity barriers in cannabis.
Exhales. He never needed to take risks. His money worked for him. Not everyone had that luxury.
&lt;&lt;set $JAplayed to true&gt;&gt;


&lt;&lt;if $MTplayed&gt;&gt;
	&lt;&lt;if $MTprison&gt;&gt;
		&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Continue|JA5A]]&lt;/div&gt;&lt;/div&gt;
	&lt;&lt;else&gt;&gt;
		&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Continue|JA5B]]&lt;/div&gt;&lt;/div&gt;
	&lt;&lt;/if&gt;&gt;
&lt;&lt;else&gt;&gt;
	&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[The End|Character Select]]&lt;/div&gt;&lt;/div&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="18" name="JA4C" tags="JA" position="1775,1050" size="100,100">&lt;img
 src="images/JA4C.JPG"/&gt;
You see a report in the Denver Pillar and it reads: Colorado’s cannabis 
boom: From War on Drugs to Wall Street. The industry is projected to 
exceed $10 billion, but Black entrepreneurs face hurdles entering the 
space."
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Back to 
John|JA4D]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="19" name="JA4D" tags="JA" position="1550,1100" size="100,100">&lt;img
 src="images/JA4D.JPG"/&gt;
You sit back on a large boat in the Chatfield Reservoir:
&lt;&lt;ctp "JA"&gt;&gt;
&lt;&lt;ja&gt;&gt;Funny. Some guys sit in a cell for selling a gram of 
this stuff.&lt;&lt;/ja&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"JA"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;ja&gt;&gt;I built an empire off it…&lt;&lt;/ja&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"JA"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;ja&gt;&gt;The system worked for me. Hell, it was built for 
me.&lt;&lt;/ja&gt;&gt;
(If things were fair, would he be where he is?)
&lt;&lt;/ctp&gt;&gt;
Your dad retires when you are 36 and the real estate business is passed 
down to you. Your dispensary chain is one of the biggest in Colorado 
with stores in most counties. You have enough money to retire now, hell 
you have enough money that your children will never have to work. 
&lt;&lt;set $JAplayed to true&gt;&gt;
&lt;&lt;if $MTplayed is true&gt;&gt;&lt;div class="center"&gt;&lt;div 
class="storychoice"&gt;[[Meet with 
Michael|JA5B]]&lt;/div&gt;&lt;/div&gt;&lt;&lt;else&gt;&gt;&lt;div 
class="center"&gt;&lt;div class="storychoice"&gt;[[Character 
Select]]&lt;/div&gt;&lt;/div&gt;&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="20" name="JA5A" tags="JA Crossover MT" position="1300,1000" size="100,100">&lt;img src="images/JA5A.JPG"/&gt;
You read a news article about cannabis industry expansion. A name catches your eye: Michael Thompson.
“Wait, I know him. Used to buy weed from him in 2003. Got locked up in 2003. He’s still there.”
“Ten years for possession. I made ten million off the same thing.”
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Character Select]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="21" name="JA5B" tags="JA Crossover MT" position="1425,1100" size="100,100">&lt;img
 src="images/JA5B.JPG"/&gt;
our dispensary chain is holding an event and members of the industry 
across Colorado are invited. You spot Michael at the event and go up to 
talk to him. 
&lt;&lt;ctp "JAandMT"&gt;&gt;
&lt;&lt;ja&gt;&gt;Michael? Damn, man, it’s been 
years.&lt;&lt;/ja&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"JAandMT"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;mt&gt;&gt;Yeah, funny how we both ended up in the same 
business.&lt;&lt;/mt&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"JAandMT"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;ja&gt;&gt;Yeah, well different starting 
points.&lt;&lt;/ja&gt;&gt;
Michael doesn’t laugh.
&lt;&lt;/ctp&gt;&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Character 
Select]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="22" name="JA90S" tags="JA" position="1525,300" size="100,100">&lt;div class="chapterHead"&gt;&lt;h2&gt;Social Context&lt;/h2&gt;&lt;hr&gt;&lt;h1&gt;The 1990s&lt;/h1&gt;&lt;/div&gt;
&lt;&lt;video "videos/93-GetHighGetStupidGetAIDS.mp4" controls&gt;&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Continue|JA1A]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="23" name="Jamal Washington" tags="JW" position="850,500" size="100,100">&lt;&lt;set $sysdis to 50&gt;&gt;
&lt;&lt;set $legal to 30&gt;&gt;
&lt;&lt;set $wealth to 20&gt;&gt;
&lt;&lt;set $health to 70&gt;&gt;
&lt;div class="chapterHead"&gt;&lt;h2&gt;Scene 2&lt;/h2&gt;&lt;hr&gt;&lt;h1&gt;Jamal Washington&lt;/h1&gt;&lt;/div&gt;
&lt;img src="images/JW0A.JPG" alt="Jamal Washington as a young man."&gt;
&lt;div class="notebox"&gt;
!!! Bio Facts
&lt;&lt;type 60ms&gt;&gt;&lt;b&gt;Year of Birth:  &lt;/b&gt;1978&lt;&lt;/type&gt;&gt;
&lt;&lt;type 60ms&gt;&gt;&lt;b&gt;Place of Birth:  &lt;/b&gt;Ruby Hill, Denver, Colorado&lt;&lt;/type&gt;&gt;
&lt;&lt;type 60ms&gt;&gt;&lt;b&gt;Race:  &lt;/b&gt;African-American&lt;&lt;/type&gt;&gt;
&lt;&lt;type 60ms&gt;&gt;&lt;b&gt;Occupation:  &lt;/b&gt;Small Business Owner&lt;&lt;/type&gt;&gt;
&lt;&lt;type 60ms&gt;&gt;&lt;b&gt;Education:  &lt;/b&gt;High School Graduate&lt;&lt;/type&gt;&gt;
&lt;&lt;type 60ms&gt;&gt;&lt;b&gt;Income:  &lt;/b&gt;Low Income&lt;&lt;/type&gt;&gt;
&lt;/div&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Meet Jamal|JW90S]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="24" name="JW00S" tags="JW" position="950,875" size="100,100">&lt;div class="chapterHead"&gt;&lt;h2&gt;Social Context&lt;/h2&gt;&lt;hr&gt;&lt;h1&gt;The 2000s&lt;/h1&gt;&lt;/div&gt;
&lt;&lt;video "videos/HugginTheBlock.mp4" controls&gt;&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Continue|JW2A]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="25" name="JW00S2" tags="JW" position="700,875" size="100,100">&lt;div class="chapterHead"&gt;&lt;h2&gt;Social Context&lt;/h2&gt;&lt;hr&gt;&lt;h1&gt;The 2000s&lt;/h1&gt;&lt;/div&gt;
&lt;&lt;video "videos/HugginTheBlock.mp4" controls&gt;&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Continue|JW2D]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="26" name="JW10S" tags="JW" position="775,1075" size="100,100">&lt;div class="chapterHead"&gt;&lt;h2&gt;Social Context&lt;/h2&gt;&lt;hr&gt;&lt;h1&gt;The 2000s&lt;/h1&gt;&lt;/div&gt;
&lt;&lt;video "videos/15-Achievements.mp4" controls&gt;&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Continue|JW3A]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="27" name="JW1A" tags="JW" position="850,625" size="100,100">&lt;img
 src="images/JW1A.JPG"/&gt;
You just graduated High School! It starts to weigh on you the decisions 
you have to make soon. Do you go to college or get a job and make money 
for your family. You decide to talk to your grandma, she always has good
 advice. 
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Talk with 
grandma|JW1B]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="28" name="JW1B" tags="JW" position="975,625" size="100,100">&lt;img
 src="images/JW1B.JPG"/&gt;
You find your grandma on the porch and just talk.
&lt;&lt;ctp "jwgmom"&gt;&gt;
&lt;&lt;jwgmom&gt;&gt;They’re building another shopping center down the 
road. Said it’ll bring in business.&lt;&lt;/jwgmom&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"jwgmom"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;JW&gt;&gt;That’s good, right?&lt;&lt;/JW&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"jwgmom"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;jwgmom&gt;&gt;Depends. Back when your granddaddy tried to open a
 grocery store, the bank wouldn't even let him through the 
door.&lt;&lt;/jwgmom&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"jwgmom"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;jwgmom&gt;&gt;Whole block got bought up by folks who had the 
right connections.&lt;&lt;/jwgmom&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"jwgmom"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;JW&gt;&gt;That was the '60s. Things changed.&lt;&lt;/JW&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"jwgmom"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
She looks up at you, shaking her head.
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"jwgmom"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;jwgmom&gt;&gt;Did they?&lt;&lt;/jwgmom&gt;&gt;
&lt;&lt;/ctp&gt;&gt;
Your left with two choices now. Do you go to college and get a degree or
 open up your small business?
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Get a 
Job|JW1C][$sysdis +=10, $wealth -=10]]&lt;/div&gt;&lt;/div&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Pursue higher
 education|JW1D][$sysdis +=5, $wealth +=10]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="29" name="JW1C" tags="JW" position="850,750" size="100,100">&lt;img
 src="images/JW1C.JPG" alt="."&gt;

You start work at the smoke shop that opened in the new shopping center.
 Selling pipes to rich college kids isn't the most fun but the paycheck 
helps your mom so its worth it.

After medical marijuana gets legalized in Colorado you get a job at new 
dispensary. You work hard but realize it doesnt matter, the boss will 
never see you how he sees your white co-workers. 

&lt;div class="center"&gt;&lt;div 
class="storychoice"&gt;[[Continue|JW00S2]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="30" name="JW1D" tags="JW" position="1050,750" size="100,100">&lt;img
 src="images/JW1D.JPG" alt="."&gt;

You finish up your degree in finance and apply for jobs based in policy 
making. You know thats the real way a difference is gonna be made about 
poverty in your communities. 
 
On top of that your student loan debt repayments start soon.
&lt;div class="center"&gt;&lt;div 
class="storychoice"&gt;[[Continue|JW00S]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="31" name="JW20S" tags="JW" position="1075,1450" size="100,100">&lt;div class="chapterHead"&gt;&lt;h2&gt;Social Context&lt;/h2&gt;&lt;hr&gt;&lt;h1&gt;The 2020s&lt;/h1&gt;&lt;/div&gt;
&lt;&lt;video "videos/SaturdayNight.mp4" controls&gt;&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Continue|JW4A]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="32" name="JW2A" tags="JW" position="1075,875" size="100,100">&lt;img
 src="images/JW2A.JPG" alt="."&gt;

You got the job! You get to help write policies for local small 
business' now. You quickly realize your not gonna be able to make the 
difference that you thought. The policies aren't designed to help people
 in your communities.
&lt;div class="center"&gt;&lt;div 
class="storychoice"&gt;[[Continue|JW2B]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="33" name="JW2B" tags="JW" position="1050,1000" size="100,100">&lt;img
 src="images/JW2B.JPG" alt="."&gt;
You review small business loan approvals in 2008 and sees how the 
funding is being distribute, and sometings not right. 

&lt;&lt;jw&gt;&gt;How come every time I push for an equity loan, it gets
 denied, but John’s expansion gets rubber-stamped?&lt;&lt;/jw&gt;&gt;
&lt;div class="center"&gt;&lt;div 
class="storychoice"&gt;[[Continue|JW2C]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="34" name="JW2C" tags="JW" position="1050,1125" size="100,100">&lt;img
 src="images/JW2C.JPG" alt="."&gt;
&lt;&lt;ctp "JW"&gt;&gt;
&lt;&lt;jw&gt;&gt;I fought to get these loan programs expanded, but it’s
 the same old game.&lt;&lt;/jw&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"JW"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;jw&gt;&gt;Wealthy applicants have the collateral, the 
connections, and the trust.&lt;&lt;/jw&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"JW"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;jw&gt;&gt;Meanwhile, Black-owned businesses account for less 
than 3% of approvals.&lt;&lt;/jw&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"JW"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;jw&gt;&gt;And here I am, fighting for scraps. What is the point 
of all this?&lt;&lt;/jw&gt;&gt;
&lt;&lt;/ctp&gt;&gt;

You're left with a decision now. Do you stay working in government 
fighting for change or quit and open your own dispensary?
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Stay in 
government and keep pushing for change|JW2E]]&lt;/div&gt;&lt;/div&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Quit and open
 your own dispensary|JW10S]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="35" name="JW2D" tags="JW" position="825,875" size="100,100">&lt;img
 src="images/JW2D.JPG" alt="."&gt;

You get a job at a medical dispensary after medical marijuana gets 
legalized. The owner only comes into the store between trips to 
different ski resorts. 

You try to get a liscense for yourself to no avail, even legalization 
doesnt mean equal access. 

Your stuck with a decision now, do you keep working for others or take a
 high interest loan to start your own medical dispensary.
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Keep working 
for others|JW2F]]&lt;/div&gt;&lt;/div&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Take a risky 
high-interest loan to start your 
business|JW10S]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="36" name="JW2E" tags="JW" position="1050,1250" size="100,100">&lt;img src="images/JW2E.JPG" alt="."&gt;
&lt;&lt;jw&gt;&gt;If I leave now, nothing changes. Maybe I can fix this.&lt;&lt;/jw&gt;&gt;
You push for stronger lending programs but most reforms end up watered down.
New leadership comes in and priorities change, fast. Its all about tax cuts now and helping the corportate entities.
After years of hitting bureaucratic walls, you can't take it anymore and decide its time.
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Continue|JW10S]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="37" name="JW2F" tags="JW" position="925,1000" size="100,100">&lt;img
 src="images/JW2F.JPG" alt="."&gt;
&lt;&lt;jw&gt;&gt;The owner makes millions. I make minimum 
wage...&lt;&lt;/jw&gt;&gt;

You stay strong and keep working hard for another couple of years.  
Pretty soon the discrepancies get to you. The owners of the business 
don't even have to work but still take home all the profit. Deep down 
you know, there's no future for you here. Maybe its time for a change?
&lt;div class="center"&gt;&lt;div 
class="storychoice"&gt;[[Continue|JW10S]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="38" name="JW3A" tags="JW" position="825,1200" size="100,100">&lt;img
 src="images/JW3A.JPG" alt="."&gt;

 You decide to finally open the dispensary you have been waiting to 
open. Its near impossible to get a fair loan, even with all the work you
 did. You have to settle for interest payments that are higher then you 
wanted but in combination with your savings, you're able to open. 
 
 Opening and the months that passed after go well, and the business is 
doing good. Local media even comes and does a feature on the store and 
interviews you. The story gets released as "Black entrepreneur breaking 
barriers."
&lt;div class="center"&gt;&lt;div 
class="storychoice"&gt;[[Continue|JW3B]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="39" name="JW3B" tags="JW" position="825,1325" size="100,100">&lt;img
 src="images/JW3B.JPG" alt="."&gt;
&lt;&lt;jw&gt;&gt;I did it. I beat the system. Didn’t 
I?&lt;&lt;/jw&gt;&gt;

With the business doing well corporate investors have reached out, 
looking to invest in your dispensary. Do you take their money to help 
with the loans but lose some control of the business? Or do you stay 
independent and ride the success of the beginning months of your new 
business. 
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Expand with 
an investor buyout|JW3C]]&lt;/div&gt;&lt;/div&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Stay 
independent|JW3D]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="40" name="JW3C" tags="JW" position="825,1450" size="100,100">&lt;img
 src="images/JW3C.JPG" alt="."&gt;
You sell part of your business to investors, the loans don't look as bad
 anymore but now your not the only one making decisions. 

&lt;&lt;jw&gt;&gt;It’s still my business, right?&lt;&lt;/jw&gt;&gt;
You watch over the years as your dispensary expands, but decisions are 
made without your input. 
By 2020, corporate takeovers accelerate. The investors sell the company 
to a larger cannabis chain.
&lt;&lt;jw&gt;&gt;I built this from the ground up. And now it’s just 
another storefront to them.&lt;&lt;/jw&gt;&gt;
The investors get tired of you pushing for business practices that help 
the community and the board pushes you out of the business with a 
severance package. 
&lt;div class="center"&gt;&lt;div 
class="storychoice"&gt;[[Continue|JW5A]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="41" name="JW3D" tags="JW" position="950,1450" size="100,100">&lt;img
 src="images/JW3D.JPG" alt="."&gt;


&lt;&lt;jw&gt;&gt;This is mine. No way I’m giving it 
up.&lt;&lt;/jw&gt;&gt;
No way you're gonna sell now, not after all this work you've put in. 
After the initial success wears off, the store begins to struggle. The 
loan repayments start to catch up and the interest keeps the principal 
high. Corporate dispensaries lower prices to drive competition out, they
 can afford to not profit now. By 2020 you are barely breaking even at 
the dispensary. Something has to change. 
&lt;div class="center"&gt;&lt;div 
class="storychoice"&gt;[[Continue|JW20S]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="42" name="JW4A" tags="JW" position="950,1575" size="100,100">&lt;img
 src="images/JW4A.JPG" alt="."&gt;
The COVID-19 pandemic hits and soon business starts to slow down. 
Corporate dispensaries have the deep pockets of their owners and get 
relief loans. Your stuck wondering how much longer you can stay open.
&lt;div class="center"&gt;&lt;div 
class="storychoice"&gt;[[Continue|JW4B]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="43" name="JW4B" tags="JW" position="950,1700" size="100,100">&lt;img
 src="images/JW4B.JPG" alt="."&gt;
&lt;&lt;jw&gt;&gt;"I need the money, but I know this is a trap. They’d 
never pull this with a guy like John."&lt;&lt;/jw&gt;&gt;

Your almost out of money but there is a few more chances for revenue. 
Colorado opened up online pickup and delivery for cannabis products 
during the pandemic, but the protocols are tight. Your not sure you are 
gonna get approved. Do you try for new streams of revenue or take on 
relief loans?
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Take on 
relief loans|JW5A]]&lt;/div&gt;&lt;/div&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Try 
alternative revenue streams|JW5B]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="44" name="JW5A" tags="JW" position="775,1700" size="100,100">&lt;img
 src="images/JW5A.JPG" alt="."&gt;

&lt;&lt;jw&gt;&gt;I've worked hard my whole life and this is how I am 
rewarded? I can't start over again, how am I going to help my 
mom?&lt;&lt;/jw&gt;&gt;

You get invited to your old co-workers retirement party. He's 6 years 
younger then you and already retiring, but you still have a long road 
ahead. 
&lt;div class="storychoice"&gt;[[The End|Character Select]]&lt;div 
class="center"&gt; wrapper&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="45" name="JW5B" tags="JW" position="1175,1625" size="100,100">&lt;img
 src="images/gildedgreen.jpg" alt="."&gt;
Getting approved for online orders and delivery is hard and time 
consuming, but you finallly get approved. By the time you get approved, a
 new corporate dispensary opens, offering deals and discounts that you 
know aren't making them money.
&lt;&lt;ctp "JW"&gt;&gt;
&lt;&lt;jw&gt;&gt;"I worked hard. Followed the rules.&lt;&lt;/jw&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"JW"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;jw&gt;&gt;And I’m still one bad month away from losing 
everything.&lt;&lt;/jw&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"JW"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;jw&gt;&gt;Tell me again how things are fair and 
equitable?&lt;&lt;/jw&gt;&gt;
&lt;&lt;/ctp&gt;&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[The 
End|Character Select]] &lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="46" name="JW90S" tags="JW" position="975,500" size="100,100">&lt;div class="chapterHead"&gt;&lt;h2&gt;Social Context&lt;/h2&gt;&lt;hr&gt;&lt;h1&gt;The 1990s&lt;/h1&gt;&lt;/div&gt;
&lt;&lt;video "videos/Responsibility.mp4" controls&gt;&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Continue|JW1A]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="47" name="Michael Thompson" tags="MT" position="225,300" size="100,100">&lt;&lt;set
 $sysdis to 50&gt;&gt;
&lt;&lt;set $legal to 30&gt;&gt;
&lt;&lt;set $wealth to 20&gt;&gt;
&lt;&lt;set $health to 70&gt;&gt;
&lt;div class="chapterHead"&gt;&lt;h2&gt;Scene 
1&lt;/h2&gt;&lt;hr&gt;&lt;h1&gt;Michael Thompson&lt;/h1&gt;&lt;/div&gt;
&lt;img src="images/MT0A.JPG" alt="Michael Thompson as a young man."&gt;
&lt;div class="notebox"&gt;
!!! Bio Facts
&lt;&lt;type 60ms&gt;&gt;&lt;b&gt;Year of Birth:  
&lt;/b&gt;1965&lt;&lt;/type&gt;&gt;
&lt;&lt;type 60ms&gt;&gt;&lt;b&gt;Place of Birth:  &lt;/b&gt;Athmar 
Park, Denver, Colorado&lt;&lt;/type&gt;&gt;
&lt;&lt;type 60ms&gt;&gt;&lt;b&gt;Race:  
&lt;/b&gt;African-American&lt;&lt;/type&gt;&gt;
&lt;&lt;type 60ms&gt;&gt;&lt;b&gt;Occupation:  &lt;/b&gt;Factory 
Worker&lt;&lt;/type&gt;&gt;
&lt;&lt;type 60ms&gt;&gt;&lt;b&gt;Education:  &lt;/b&gt;High School 
Graduate&lt;&lt;/type&gt;&gt;
&lt;&lt;type 60ms&gt;&gt;&lt;b&gt;Income:  &lt;/b&gt;Low 
Income&lt;&lt;/type&gt;&gt;
&lt;/div&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[You start by 
graduating high school, so big choices are just 
ahead.|MT80S]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="48" name="MT00S" tags="MT" position="375,550" size="100,100">&lt;div class="chapterHead"&gt;&lt;h2&gt;Social Context&lt;/h2&gt;&lt;hr&gt;&lt;h1&gt;The 2000s&lt;/h1&gt;&lt;/div&gt;
&lt;&lt;video "videos/07-MyFriendsSmokeWeed.mp4" controls&gt;&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Continue|MT3A]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="49" name="MT1A" tags="MT" position="0,425" size="100,100">&lt;img
 src="images/MT1A.JPG"/&gt;
You finish high school in the early 1980s and begin to look for work. 
There are lots of factory jobs available but the pay isn't great and no 
one looks happy when they leave. You could also try to open the food 
truck you have been dreaming of opening your whole life. You don't have 
the money so you would need a loan to start, and its well known that its
 hard to get loan. Do you take a factory job or start your side 
business?
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Take a 
low-wage factory job|MT90S][$sysdis +=5, $wealth 
-=10]]&lt;/div&gt;&lt;/div&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Start a small
 side business|MT90S][$sysdis +=10, $wealth 
-=10]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="50" name="MT20S" tags="MT" position="300,700" size="100,100">&lt;div class="chapterHead"&gt;&lt;h2&gt;Social Context&lt;/h2&gt;&lt;hr&gt;&lt;h1&gt;The 2020s&lt;/h1&gt;&lt;/div&gt;
&lt;&lt;video "videos/10-Diner.mp4" controls&gt;&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Continue|MT5A]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="51" name="MT2A" tags="MT" position="250,425" size="100,100">&lt;img
 src="images/MT2A.JPG"/&gt;
Many people in your neighborhood have been getting arrested for minor 
cannabis offenses. You see your brother, Malik, outside the corner 
store.
&lt;&lt;ctp "MTandMTbro"&gt;&gt;
&lt;&lt;mt&gt;&gt;Stay in school, man.&lt;&lt;/mt&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"MTandMTbro"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;mtbro&gt;&gt;Yeah, yeah, I will&amp;hellip;but Jason’s brother 
just got locked up for some weed. What’s the 
point?&lt;&lt;/mtbro&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"MTandMTbro"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
You shake your head, but you know Malik's got a point.
&lt;&lt;/ctp&gt;&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Just then, 
you overhear a news report on the 
radio...|MT2B]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="52" name="MT2B" tags="MT" position="125,550" size="100,100">&lt;img
 src="images/radio.JPG"/&gt;
You overhear a radio report:
&lt;&lt;ctp "radio"&gt;&gt;
&lt;&lt;radio&gt;&gt;Under the 1986 Anti-Drug Abuse 
Act,&lt;&lt;/radio&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"radio"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;radio&gt;&gt;mandatory minimum sentences mean minor drug 
offenses could land you in prison for years.&lt;&lt;/radio&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"radio"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;radio&gt;&gt;Critics argue this disproportionately impacts Black
 communities.&lt;&lt;/radio&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"radio"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
After thinking for a minute, you shake your head&amp;hellip;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"radio"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;mt&gt;&gt;I'm not selling, so I'm 
fine&amp;hellip;right??&lt;&lt;/mt&gt;&gt;
&lt;&lt;/ctp&gt;&gt;
What do you do? Do you avoid cannabis entirely, only use casually, or 
start smoking regularly?
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Avoid 
cannabis use entirely|MT2C][$wealth -=5]]&lt;/div&gt;&lt;/div&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Casual 
use|MT2D][$legal +=10, $sysdis +=5,$MTprison to 
true]]&lt;/div&gt;&lt;/div&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Association 
with users|MT2E][$legal +=10, $sysdis +=5,$MTprison to 
true]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="53" name="MT2C" tags="MT" position="50,700" size="100,100">You
 decide to avoid cannabis use entirely. You know its not worth the risk 
but its hard to go watch your friends use while you are avoiding. 
&lt;&lt;mt&gt;&gt;“Man, I’m not risking my future over this…but damn, 
same thing John’s rich friends do all the time and nobody 
cares."&lt;&lt;/mt&gt;&gt;
&lt;div class="center"&gt;&lt;div 
class="storychoice"&gt;[[Continue|MT4A]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="54" name="MT2D" tags="MT" position="175,700" size="100,100">&lt;img
 src="images/MT2D.JPG"/&gt;
As you talk with your brother outside the corner store, your friend 
passes you a joint.
&lt;&lt;ctp "MTandMTbro"&gt;&gt;
&lt;&lt;mt&gt;&gt;What’s the worst that could happen? It’s just a little
 weed…cops got bigger problems, right?&lt;&lt;/mt&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"MTandMTbro"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;mtbro&gt;&gt;You said this stuff was 
stupid.&lt;&lt;/mtbro&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"MTandMTbro"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;mt&gt;&gt;I don’t make the rules, man.&lt;&lt;/mt&gt;&gt;
&lt;&lt;/ctp&gt;&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[The cops show
 up|MT2E]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="55" name="MT2E" tags="MT" position="250,550" size="100,100">&lt;img
 src="images/MT3A.JPG"/&gt;
The cops show up and you know you are screwed now. They caught you red 
handed with the joint in your hand. The cops arrest you and take you to 
jail. You can hear your moms distress when you call her from the 
jailhouse phone. Its too late for visitors now, you'll have to spend the
 night in jail before you can see your mom. She visits the next day:
&lt;&lt;ctp "MTandMTmom"&gt;&gt;
&lt;&lt;mt&gt;&gt;I just don't know how this 
happened.&lt;&lt;/mt&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"MTandMTmom"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;mtmom&gt;&gt;Don't matter. I worked two jobs to keep you boys 
safe. Now…look at you.&lt;&lt;/mtmom&gt;&gt;
&lt;&lt;/ctp&gt;&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[You had a 
good lawyer|MT20S]]&lt;/div&gt;&lt;/div&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Wrong place, 
wrong time|MT00S]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="56" name="MT3A" tags="MT" position="500,825" size="100,100">&lt;img
 src="images/MT3B.JPG"/&gt;
You present yourself in the courtroom for sentencing.

&lt;&lt;ctp "MTandMTjudge"&gt;&gt;


&lt;&lt;mtjudge&gt;&gt;Under federal law, I have no discretion 
here.&lt;&lt;/mtjudge&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"MTandMTjudge"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;mtjudge&gt;&gt;The sentence is set at 10 years regardless of 
circumstances.&lt;&lt;/mtjudge&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"MTandMTjudge"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
Your mom stares blankly.
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"MTandMTjudge"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
Your public defender doesn’t make eye contact.
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"MTandMTjudge"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
You think to yourself...
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"MTandMTjudge"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;mt&gt;&gt;Ten years? Ten damn years? There's no 
way…&lt;&lt;/mt&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"MTandMTjudge"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;mt&gt;&gt;but I see the look on my lawyer’s face. This was 
decided before I even walked in.”&lt;&lt;/mt&gt;&gt;
&lt;&lt;/ctp&gt;&gt;
&lt;&lt;if $JWplayed is true&gt;&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[MT6A][$wealth
 -=50, %health -=40, $sysdis +=20]]&lt;/div&gt;&lt;/div&gt;
&lt;&lt;else&gt;&gt;&lt;div class="center"&gt;&lt;div 
class="storychoice"&gt;[[MT5F][$wealth -=50, %health -=40, $sysdis 
+=20]]&lt;/div&gt;&lt;/div&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="57" name="MT4A" tags="MT" position="50,825" size="100,100">&lt;img
 src="images/MT4A.JPG"/&gt;
Social-equity business licenses become available for the cannabis 
industry following its legalization. Prior offenders face harder 
restrictions and decreased access to resources. Do you apply for a 
social-equity license to start a dispensary? Or keep working in facrtoy 
jobs?
&lt;&lt;if $MTprison is true&gt;&gt;&lt;div class="center"&gt;&lt;div 
class="storychoice"&gt;[[Continue|MT5A]]&lt;/div&gt;&lt;/
div&gt;&lt;&lt;else&gt;&gt;&lt;div class="center"&gt;&lt;div 
class="storychoice"&gt;[[Apply for a social-equity business liscense to 
open a dispensary|MT5B]]&lt;/div&gt;&lt;/div&gt;&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="58" name="MT5A" tags="MT" position="300,825" size="100,100">&lt;img src="images/MT5A.JPG"/&gt;
You continue to work in factory jobs but still struggle with the low income and not being able to make more money. 
&lt;&lt;set $MTplayed to true&gt;&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Character Select]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="59" name="MT5B" tags="MT" position="0,950" size="100,100">&lt;img
 src="images/MT5B.JPG"/&gt;
After jumping through countless hoops, your application for a business 
license gets approved. You become a cannabis business owner due to 
social-equity programs.
&lt;&lt;if $JWplayed&gt;&gt;&lt;div class="center"&gt;&lt;div 
class="storychoice"&gt;[[MT6E]]&lt;/div&gt;&lt;/
div&gt;&lt;&lt;else&gt;&gt;&lt;div class="center"&gt;&lt;div 
class="storychoice"&gt;[[MT5C]]&lt;/div&gt;&lt;/div&gt;&lt;&lt;/if&gt;</tw-passagedata><tw-passagedata pid="60" name="MT5C" tags="MT" position="125,950" size="100,100">&lt;img src="images/MT5C.JPG"/&gt;
&lt;&lt;mt&gt;&gt;“I made it, but how many others like me never got the chance?”&lt;&lt;/mt&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[MT5D]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="61" name="MT5D" tags="MT" position="250,950" size="100,100">&lt;img src="images/MT5D.JPG"/&gt;
&lt;&lt;mt&gt;&gt;“Malik wanted to start a business, too…until the system swallowed him whole.”&lt;&lt;/mt&gt;&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[MT5E]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="62" name="MT5E" tags="MT" position="375,950" size="100,100">&lt;img
 src="images/MT5C.JPG"/&gt;
&lt;&lt;mt&gt;&gt;They said social equity would fix this, but if the 
system never broke us in the first place, we wouldn’t need ‘equity’ to 
begin with.”&lt;&lt;/mt&gt;&gt;
&lt;&lt;set$MTplayed to true&gt;&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Character 
Select]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="63" name="MT5F" tags="MT" position="400,1200" size="100,100">&lt;img
 src="images/MT6B.JPG"/&gt;
&lt;&lt;ctp "MT"&gt;&gt;
&lt;&lt;mt&gt;&gt;They legalized it.&lt;&lt;/mt&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"MT"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;mt&gt;&gt;Same thing that got me locked up…white kids are making
 millions off it now&lt;&lt;/mt&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"MT"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;mt&gt;&gt;If I’d been born in a different zip 
code…&lt;&lt;/mt&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"MT"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;mt&gt;&gt;If my skin were a little lighter…would I be at some 
investor’s table right now instead of here?”&lt;&lt;/mt&gt;&gt;
&lt;&lt;/ctp&gt;&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Continue 
living in prison|MT5G]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="64" name="MT5G" tags="MT" position="575,1200" size="100,100">&lt;img
 src="images/MT5G.JPG"/&gt;
The years tick pass on your prison sentence, slowly but surely. You know
 your not getting out for a long time. Eventually you start to grow old 
in prison and know that you might die here one day. 

After a long prison sentence, Michael dies in prison.
&lt;&lt;Set $MTplayed to true&gt;&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Character 
Select]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="65" name="MT6A" tags="MT Crossover JW" position="475,1075" size="100,100">You
 have been living in prison for a while now. The guards tell you that 
you have a new visitor, something that doesnt happen very often. The 
guards take you to the visitor center and you see your old friend, Jamal
 Washington. 
&lt;&lt;ctp "MTandJW"&gt;&gt;
 &lt;&lt;jw&gt;&gt;"Man. You remember when we used to talk about opening
 a shop together?&lt;&lt;/jw&gt;&gt;
 &lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"MTandJW"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;mt&gt;&gt;Yeah, before they decided I didn’t deserve a second 
chance.&lt;&lt;/mt&gt;&gt;
 &lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"MTandJW"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;jw&gt;&gt;They legalized it. You should be 
out.&lt;&lt;/jw&gt;&gt;
 &lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"MTandJW"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;mt&gt;&gt;Should. But ain’t nobody rushing to undo what they did
 to us.&lt;&lt;/mt&gt;&gt;
&lt;div class="center"&gt;&lt;div 
class="storychoice"&gt;[[MT5F]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="66" name="MT6E" tags="MT Crossover JW" position="275,1200" size="100,100">&lt;img
 src="images/MT5B.JPG"/&gt;
Your new dispensary has been running for a while with mild success. It's
 not an easy living but the business is staying afloat. One day when you
 are working the counter, you get a visit from an old friend, Jamal 
Washington. 
&lt;&lt;ctp "MTandJW"&gt;&gt;
&lt;&lt;jw&gt;&gt;Jamal: Man, you really did it&lt;&lt;/jw&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"MTandJW"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;mt&gt;&gt;Barely. They ain’t make it easy.&lt;&lt;/mt&gt;&gt;
&lt;&lt;button "Next"&gt;&gt;&lt;&lt;ctpAdvance 
"MTandJW"&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;ctpNext&gt;&gt;
&lt;&lt;jw&gt;&gt;Tell me about it…&lt;&lt;/jw&gt;&gt;
(his own shop struggles across town, competing against big 
corporations.)
&lt;&lt;/ctp&gt;&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Character 
Select]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="67" name="MT80S" tags="MT" position="100,300" size="100,100">&lt;div class="chapterHead"&gt;&lt;h2&gt;Social Context&lt;/h2&gt;&lt;hr&gt;&lt;h1&gt;The 1980s&lt;/h1&gt;&lt;/div&gt;
&lt;&lt;video "videos/89-Snake.mp4" controls&gt;&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Continue|MT1A]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="68" name="MT90S" tags="MT" position="125,425" size="100,100">&lt;div class="chapterHead"&gt;&lt;h2&gt;Social Context&lt;/h2&gt;&lt;hr&gt;&lt;h1&gt;The 1990s&lt;/h1&gt;&lt;/div&gt;
&lt;&lt;video "videos/90-StraightUp.mp4" controls&gt;&gt;
&lt;div class="center"&gt;&lt;div class="storychoice"&gt;[[Continue|MT2A]]&lt;/div&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="69" name="StoryInit" tags="Special-Passage" position="100,100" size="100,100">&lt;&lt;set $sysdis to 0&gt;&gt;
&lt;&lt;set $legal to 0&gt;&gt;
&lt;&lt;set $wealth to 0&gt;&gt;
&lt;&lt;set $health to 0&gt;&gt;
&lt;&lt;set $MTprison to false&gt;&gt;
&lt;&lt;set $MTplayed to false&gt;&gt;
&lt;&lt;set $JAplayed to false&gt;&gt;
&lt;&lt;set $JWplayed to false&gt;&gt;

&lt;&lt;character 'mtmom' 'Mom' 'images/MTmom.JPG'&gt;&gt;
&lt;&lt;character 'mtbro' 'Malik' 'images/MTbro.JPG'&gt;&gt;
&lt;&lt;character 'mtjudge' 'Judge' 'images/MTjudge.JPG'&gt;&gt;
&lt;&lt;character 'mt' 'Michael' 'images/MT.JPG'&gt;&gt;
&lt;&lt;character 'jw' 'Jamal' 'images/JW.JPG'&gt;&gt;
&lt;&lt;character 'ja' 'John' 'images/JA.JPG'&gt;&gt;
&lt;&lt;character 'jadad' 'Dad' 'images/JAdad.JPG'&gt;&gt;
&lt;&lt;character 'jwmom' 'Mom' 'images/JWmom.JPG'&gt;&gt;
&lt;&lt;character 'jwgmom' 'Grandmom' 'images/jwgmom.JPG'&gt;&gt;
&lt;&lt;character 'jafriend' 'Partner' 'images/JAfriend.JPG'&gt;&gt;
&lt;&lt;character 'radio' 'KGNU' 'images/radio.jpg'&gt;&gt;</tw-passagedata></tw-storydata>
</div>

</body></html>